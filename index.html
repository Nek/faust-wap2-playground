<!DOCTYPE html>
<html>
  <meta
    http-equiv="Cache-Control"
    content="no-cache, no-store, must-revalidate"
  />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <head>
    <title>Host that loads a plugin with its GUI</title>
  </head>
  <body>
    <canvas width="600" height="300" id="spectrum"></canvas>
    <canvas width="600" height="300" id="oscilloscope"></canvas>
  </body>
  <script type="module">
    import loadPlugin from "./loadPlugin.js"
    import spectrometer from "./spectrometer.js"
    import oscilloscope from "./oscilloscope.js"

    var ctx = new AudioContext()

    var pluginURL = "."

    const FFT_SIZE = 1024

    var splitter = ctx.createChannelSplitter(3)
    var analyser = ctx.createAnalyser()
    analyser.fftSize = FFT_SIZE
    var beatAnalyser = ctx.createAnalyser()
    beatAnalyser.fftSize = FFT_SIZE

    loadPlugin(ctx, pluginURL).then((node) => {
      console.log(node.getDescriptor())
      node.connect(splitter)
      node.connect(analyser)
      splitter.connect(beatAnalyser, 2, 0)
      node.connect(ctx.destination)
      spectrometer(analyser, document.getElementById("spectrum"))
      oscilloscope(beatAnalyser, document.getElementById("oscilloscope"))
    })
  </script>
</html>
