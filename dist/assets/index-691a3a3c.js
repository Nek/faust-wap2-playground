(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const fe=(t,e,n,s=window.devicePixelRatio||1)=>(s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s),en=()=>(window.devicePixelRatio||1)>1;function ar(t,e,n,s){var r=arguments.length,o=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,n):s,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}const cr=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),r=Symbol("isa");function o(i){for(let a of n){const c=Object.getOwnPropertyDescriptor(i.prototype,a);(!c||c.configurable)&&Object.defineProperty(i.prototype,a,{value:t[a],writable:!0})}return Object.defineProperty(i.prototype,r,{value:!0}),i}for(let i of s)Object.defineProperty(o,i,{value:e[i],enumerable:e.propertyIsEnumerable(i)});return Object.defineProperty(o,Symbol.hasInstance,{value:i=>!!i[r]}),o},lr=cr({addWatch(t,e){return this._watches=this._watches||{},this._watches[t]?!1:(this._watches[t]=e,!0)},removeWatch(t){if(this._watches)return this._watches[t]?(delete this._watches[t],!0):!1},notifyWatches(t,e){if(!this._watches)return;const n=this._watches;for(let s in n)n[s](s,t,e)}}),ht=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{constructor(n){super(t(n)+e(n))}},ur=ht(()=>"illegal state"),jn=t=>{throw new ur(t)},Y=Array.isArray,hr=t=>t&&(t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint8ClampedArray),K=t=>typeof t=="string",fr=ht(()=>"Assertion failed"),Ie=(typeof process<"u"&&process.env!==void 0?{}.UMBRELLA_ASSERTS:{}.VITE_UMBRELLA_ASSERTS)?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new fr(typeof e=="function"?e():e)}:()=>{},Un=t=>Y(t)?t:K(t)?t.length>0?t.split("."):[]:t!=null?[t]:[];function Bn(t){const e=Un(t),[n,s,r,o]=e;switch(e.length){case 0:return(a,c)=>c;case 1:return(a,c)=>(a=C(a),a[n]=c,a);case 2:return(a,c)=>{let l;return a=C(a),a[n]=l=C(a[n]),l[s]=c,a};case 3:return(a,c)=>{let l,u;return a=C(a),a[n]=l=C(a[n]),l[s]=u=C(l[s]),u[r]=c,a};case 4:return(a,c)=>{let l,u,p;return a=C(a),a[n]=l=C(a[n]),l[s]=u=C(l[s]),u[r]=p=C(u[r]),p[o]=c,a};default:let i;for(let a=e.length;a-- >0;)i=dr(e[a],i);return i}}const C=t=>Y(t)||hr(t)?t.slice():{...t},dr=(t,e)=>(n,s)=>(n=C(n),n[t]=e?e(n[t],s):s,n),nn=(t,e,n)=>Bn(e)(t,n),pr=t=>t;function mr(t){const e=Un(t),[n,s,r,o]=e;switch(e.length){case 0:return pr;case 1:return i=>i?.[n];case 2:return i=>i!=null&&(i=i[n])!=null?i[s]:void 0;case 3:return i=>i!=null&&(i=i[n])!=null&&(i=i[s])!=null?i[r]:void 0;case 4:return i=>i!=null&&(i=i[n])!=null&&(i=i[s])!=null&&(i=i[r])!=null?i[o]:void 0;default:return i=>{const a=e.length-1;let c=i;for(let l=0;c!=null&&l<=a;l++)c=c[e[l]];return c}}}const sn=(t,e,n,...s)=>_r(t,e,n,...s);function _r(t,e,n,...s){return Bn(e)(t,n.apply(null,(s.unshift(mr(e)(t)),s)))}let de=class{constructor(e,n){n&&!n(e)&&jn("initial state value did not validate"),this._value=e,this.valid=n}get value(){return this._value}set value(e){this.reset(e)}deref(){return this._value}equiv(e){return this===e}reset(e){const n=this._value;return this.valid&&!this.valid(e)?n:(this._value=e,this.notifyWatches(n,e),e)}resetIn(e,n){return this.reset(nn(this._value,e,n))}resetInUnsafe(e,n){return this.reset(nn(this._value,e,n))}swap(e,...n){return this.reset(e.apply(null,[this._value,...n]))}swapIn(e,n,...s){return this.reset(sn(this._value,e,n,...s))}swapInUnsafe(e,n,...s){return this.reset(sn(this._value,e,n,...s))}addWatch(e,n){}removeWatch(e){}notifyWatches(e,n){}release(){return delete this._watches,delete this._value,!0}};de=ar([lr],de);const z=Symbol(),O=()=>{},Ee=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",rn=Object.getPrototypeOf({}),bt="function",on="string",Q=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===bt)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===bt)return e.equiv(t)}else return t==e;return typeof t===on||typeof e===on?!1:(n=Object.getPrototypeOf(t),(n==null||n===rn)&&(n=Object.getPrototypeOf(e),n==null||n===rn)?qn(t,e):typeof t!==bt&&t.length!==void 0&&typeof e!==bt&&e.length!==void 0?zn(t,e):t instanceof Set&&e instanceof Set?xn(t,e):t instanceof Map&&e instanceof Map?Gn(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},zn=(t,e,n=Q)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},xn=(t,e,n=Q)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),Gn=(t,e,n=Q)=>t.size===e.size&&n([...t].sort(),[...e].sort()),qn=(t,e,n=Q)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0};let gt,yt,br=[],gr=[];const yr=t=>gt&&gt.length>=t?gt:gt=new Int32Array(t),wr=t=>yt&&yt.length>=t?yt:yt=new Int32Array(t),an=(t,e,n,s,r)=>{const o=e.length,i=t.linear;if(t.distance=o,r!=="only-distance"){for(let a=0,c=0;a<o;a++,c+=3)i[c]=s,i[c+1]=a,i[c+2]=e[a];if(r==="full"){const a=t[n];for(let c=0;c<o;c++)a[c]=e[c]}}return t},Wn=(t,e,n="full",s=Q)=>{const r={distance:0,adds:{},dels:{},const:{},linear:[]};if(t===e||t==null&&e==null)return r;if(t==null||t.length===0)return an(r,e,"adds",1,n);if(e==null||e.length===0)return an(r,t,"dels",-1,n);const o=t.length>=e.length;let i,a,c,l;o?(i=e,a=t):(i=t,a=e),c=i.length,l=a.length;const u=c+1,p=l-c,h=p+u,d=c+l+3,f=wr(d).fill(-1,0,d),m=yr(d).fill(-1,0,d),_=br,b=gr,w=(I,v,E)=>{let k,M;v>E?(k=f[I-1],M=v):(k=f[I+1],M=E);let X=M-(I-u);for(;X<c&&M<l&&s(i[X],a[M]);)X++,M++;f[I]=b.length/3,b.push(X,M,k),m[I]=M};let g=-1,y;do{for(g++,y=-g+u;y<h;y++)w(y,m[y-1]+1,m[y+1]);for(y=h+g;y>h;y--)w(y,m[y-1]+1,m[y+1]);w(h,m[h-1]+1,m[h+1])}while(m[h]!==l);if(r.distance=p+2*g,n!=="only-distance"){for(g=f[h]*3;g>=0;)_.push(g),g=b[g+2]*3;n==="full"?Sr(_,b,r,i,a,o):Ir(_,b,r,i,a,o,n==="only-distance-linear")}return _.length=0,b.length=0,r},Sr=(t,e,n,s,r,o)=>{const i=n.linear,a=n.const;let c=t.length,l=0,u=0,p,h,d,f;for(o?(p=n.dels,h=n.adds,d=-1,f=1):(p=n.adds,h=n.dels,d=1,f=-1);c-- >0;){const m=t[c],_=e[m],b=e[m+1],w=b-_;for(;l<_||u<b;){const g=u-l;w>g?(i.push(d,u,p[u]=r[u]),u++):w<g?(i.push(f,l,h[l]=s[l]),l++):(i.push(0,l,a[l]=s[l]),l++,u++)}}},Ir=(t,e,n,s,r,o,i)=>{const a=n.linear,c=o?-1:1,l=o?1:-1;let u=t.length,p=0,h=0;for(;u-- >0;){const d=t[u],f=e[d],m=e[d+1],_=m-f;for(;p<f||h<m;){const b=h-p;_>b?(a.push(c,h,r[h]),h++):_<b?(a.push(l,p,s[p]),p++):(i&&a.push(0,p,s[p]),p++,h++)}}},Er=(t,e,n="full",s=Q)=>t===e?{distance:0}:n==="only-distance"?vr(t,e,s):Ar(t,e,s),vr=(t,e,n)=>{t||(t={}),e||(e={});let s=0;for(let r in t){const o=e[r];(o===void 0||!n(t[r],o))&&s++}for(let r in e)!(r in t)&&s++;return{distance:s}},Ar=(t,e,n)=>{t||(t={}),e||(e={});let s=0;const r=[],o=[],i=[];for(let a in t){const c=e[a];c===void 0?(o.push(a),s++):n(t[a],c)||(i.push(a,c),s++)}for(let a in e)a in t||(r.push(a),s++);return{distance:s,adds:r,dels:o,edits:i}},Bt=Array.isArray,Mr=Math.max,cn=Object.getPrototypeOf({}),wt="function",kt="string",ln=(()=>{const t=new Array(2048);for(let e=2,n=t.length;e<n;e++)t[e]=e-2;return t})(),Dr=t=>{if(t<=ln.length)return ln.slice(0,t);const e=new Array(t);for(;t-- >2;)e[t]=t-2;return e},Xn=(t,e,n,s,r,o=0)=>{const i=r[1];if(i.__skip)return;if(i.__diff===!1){st(s),e.replaceChild(t,n,o,r);return}const a=s[1];if(a&&a.__skip){e.replaceChild(t,n,o,r,!1);return}let c=i.__impl;if(c&&c!==e)return c.diffTree(t,c,n,s,r,o);const l=Wn(s,r,"only-distance-linear",et);if(l.distance===0)return;const u=l.linear,p=e.getChild(n,o);let h,d,f;if(u[0]!==0||s[1].key!==i.key){st(s),e.replaceChild(t,n,o,r);return}if((f=s.__release)&&f!==r.__release&&st(s),u[3]!==0&&(Cr(e,p,s[1],r[1]),l.distance===2))return;const m=u.length,_=s.length-1,b=Rr(u),w=Dr(_+1);for(h=6;h<m;h+=3)d=u[h],d&&(d===-1?Tr(t,e,p,s,r,u,h,b,w,_):kr(t,e,p,u,h,b,w,_));(f=r.__init)&&f!=s.__init&&f.apply(r,[p,...r.__args])},Tr=(t,e,n,s,r,o,i,a,c,l)=>{const u=o[i+2];if(Bt(u)){let p=u[1].key;if(p!==void 0&&a[p][2]!==void 0){const h=a[p];p=h[0],Xn(t,e,n,s[p],r[h[2]],c[p])}else{const h=o[i+1];st(u),e.removeChild(n,c[h]),Or(c,l,h)}}else typeof u===kt&&e.setContent(n,"")},kr=(t,e,n,s,r,o,i,a)=>{const c=s[r+2];if(typeof c===kt)e.setContent(n,c);else if(Bt(c)){const l=c[1].key;if(l===void 0||o[l][0]===void 0){const u=s[r+1];e.createTree(t,n,c,i[u]),Pr(i,a,u)}}},Or=(t,e,n)=>{for(;e>n;e--)t[e]=Mr(t[e]-1,0)},Pr=(t,e,n)=>{for(;e>=n;e--)t[e]++},Cr=(t,e,n,s)=>{const r=Er(n,s,"full",Q);t.removeAttribs(e,r.dels,n);let o=z,i,a,c;for(c=r.edits,i=c.length;(i-=2)>=0;)a=c[i],a[0]==="o"&&a[1]==="n"&&t.removeAttribs(e,[a],n),a!=="value"?t.setAttrib(e,a,c[i+1],s):o=c[i+1];for(c=r.adds,i=c.length;i-- >0;)a=c[i],a!=="value"?t.setAttrib(e,a,s[a],s):o=s[a];o!==z&&t.setAttrib(e,"value",o,s)},st=t=>{if(Bt(t)){let e;if((e=t[1])&&e.__release===!1)return;for(t.__release&&(t.__release.apply(t.__this,t.__args),delete t.__release),e=t.length;e-- >2;)st(t[e])}},Rr=t=>{let e,n,s;const r={};for(let o=t.length;(o-=3)>=0;)n=t[o+2],Bt(n)&&(e=n[1].key)!==void 0&&(s=r[e],!s&&(r[e]=s=[,,]),s[t[o]+1]=t[o+1]);return r},et=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===wt)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===wt)return e.equiv(t)}else return t==e;return typeof t===kt||typeof e===kt?!1:(n=Object.getPrototypeOf(t),(n==null||n===cn)&&(n=Object.getPrototypeOf(e),n==null||n===cn)?!(t.__diff===!1||e.__diff===!1)&&qn(t,e,et):typeof t!==wt&&t.length!==void 0&&typeof e!==wt&&e.length!==void 0?zn(t,e,et):t instanceof Set&&e instanceof Set?xn(t,e,et):t instanceof Map&&e instanceof Map?Gn(t,e,et):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},F=(t,e)=>t!=null&&typeof t[e]=="function",zt=Math.PI,R=zt*2,pe=zt/2;let U=1e-6;const xt=(t,e)=>{let n;(n=e.fill)&&n!=="none"&&t.fill(),(n=e.stroke)&&n!=="none"&&t.stroke(),(n=e.clip)&&t.clip(n===!0?"nonzero":n)},un=(t,e,n,s,r=0,o=R,i=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,r,o,i),xt(t,e)},$r=(t,e,n,s,r=0,o=0,i=R,a=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],r,o,i,a),xt(t,e)},ct=t=>typeof t=="number",Nr=ht(()=>"unsupported operation"),ve=t=>{throw new Nr(t)},ne={},Lr=(t,e,n,s)=>{const r=ne[n];Ie(!!r,`no conversions available for ${n}`);let o=r[s];return o?o(t,e):ne.rgb[s]?r.rgb(t,ne.rgb[s]([],e)):ve(`can't convert: ${s} -> ${n}`)},Et=(t,e,n)=>t<e?e:t>n?n:t,Ot=t=>t>0?t:0,N=t=>t<0?0:t>1?1:t,Ae=t=>t-Math.floor(t),Fr=(t,e=1)=>Math.round(t/e)*e;function ft(t,e){return!e&&(e={}),(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}const Jn=ft((t,e)=>t.repeat(e)),Gt=ft((t,e=" ")=>{const n=Jn(String(e),t);return(s,r)=>s==null?n:(s=s.toString(),r=r!==void 0?r:s.length,r<t?n.substring(r)+s:s)});Gt(2,"0");Gt(3,"0");Gt(4,"0");const Me=ft((t,e=!1)=>e?n=>Zn(n)||n.toFixed(t):n=>n.toFixed(t));ft((t,e=3)=>{const n=t-e-1,s=Math.pow(10,n),r=-Math.pow(10,n-1),o=Math.pow(10,-(e-1)),i=Gt(t);return a=>{const c=Math.abs(a);return i(Zn(a)||(a===0?"0":c<o||c>=s?Vr(a,t):a.toFixed(e-(a<r?1:0))))}});const Vr=(t,e)=>t.toExponential(Math.max(e-4-(Math.log(Math.abs(t))/Math.LN10>=10?2:1)-(t<0?1:0),0)),Zn=t=>isNaN(t)?"NaN":t===1/0?"+∞":t===-1/0?"-∞":void 0,Hr=(t=0)=>e=>(e*100).toFixed(t)+"%",jr=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],Ur=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],Br=[1.0478112,.0295424,-.0092345,.0228866,.9904844,.0150436,-.050127,-.0170491,.7521316],Yn=[.96422,1,.82521],zr=[.95047,1,1.08883];let L=Me(3),Pt=Hr(3);const xr=1/255,V=(t,e=1)=>t!=null?N(t):e,Kn=t=>{const e=L(Ae(t[0])*360),n=Pt(N(t[1])),s=Pt(N(t[2])),r=V(t[3]);return r<1?`hsla(${e},${n},${s},${L(r)})`:`hsl(${e},${n},${s})`},Gr=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),x=(t,e,n,s,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=r,t),qr=(t,e,n=1)=>x(t||e,Ae(e[0]),N(e[1]),N(e[2]),V(e[3],n)),Wr=(t,e)=>{t=qr(t||e,e);const n=t[1],s=t[2],r=(2-n)*s/2;return t[2]=r,t[1]=r&&r<1?n*s/(r<.5?r*2:2-r*2):n,t},Xr=t=>Kn(Wr([],t)),hn="0123456789abcdef",me=t=>hn[t>>>4&15]+hn[t&15],Jr=t=>me(t>>>8)+me(t&255),Zr=t=>me(t>>>16)+Jr(t),De=ft((t,e,n="")=>{const s=Jn("0",e);return r=>(r=(r>>>0).toString(t),n+(r.length<e?s.substring(r.length)+r:r))});De(2,8);De(2,16);De(2,32);const Qn=Zr,_e=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${L(e*xr)})`:`#${Qn(t&16777215)}`},Yr=t=>(t&255)<<16|t>>16&255|t&4278255360,Kr=Yr,ts=(t,e,n)=>{const s=Pt(Ot(e[0])),r=L(e[1]*n),o=L(e[2]*n),i=V(e[3]);return`${t}(${s} ${r} ${o}`+(i<1?`/${L(i)})`:")")},es=(t,e,n)=>{const s=Pt(Ot(e[0])),r=L(Ot(e[1])*n),o=L(Ae(e[2])*360),i=V(e[3]);return`${t}(${s} ${r} ${o}`+(i<1?`/${L(i)})`:")")},fn=t=>ts("lab",t,100),se=t=>t>.00885645?Math.cbrt(t):7.787037*t+16/116,Qr=(t,e,n=Yn)=>{const s=se(e[0]/n[0]),r=se(e[1]/n[1]),o=se(e[2]/n[2]);return x(t||e,1.16*r-.16,5*(s-r),2*(r-o),V(e[3]))},to=ht(()=>"illegal arity"),Te=t=>{throw new to(t)};function ns(...t){let[e,n,s,r,o,i,a,c,l,u]=t;switch(t.length){case 0:Te(0);case 1:return e;case 2:return(...h)=>e(n(...h));case 3:return(...h)=>e(n(s(...h)));case 4:return(...h)=>e(n(s(r(...h))));case 5:return(...h)=>e(n(s(r(o(...h)))));case 6:return(...h)=>e(n(s(r(o(i(...h))))));case 7:return(...h)=>e(n(s(r(o(i(a(...h)))))));case 8:return(...h)=>e(n(s(r(o(i(a(c(...h))))))));case 9:return(...h)=>e(n(s(r(o(i(a(c(l(...h)))))))));case 10:default:const p=(...h)=>e(n(s(r(o(i(a(c(l(u(...h))))))))));return t.length===10?p:ns(p,...t.slice(10))}}const qt=t=>F(t,"xform")?t.xform():t;function ss(...t){return t=t.map(qt),ns.apply(null,t)}const ke=t=>t!=null&&typeof t[Symbol.iterator]=="function",Oe=(t,e)=>[t[0],t[1],e],rs=t=>t!=null&&typeof t!="function"&&t.length!==void 0;class lt{constructor(e){this.value=e}deref(){return this.value}}const eo=t=>new lt(t),G=t=>t instanceof lt,os=t=>t instanceof lt?t:new lt(t),rt=t=>t instanceof lt?t.deref():t,no=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Te(t.length);function so(...t){const e=t[0],n=e[0],s=e[1],r=e[2];t=no(t);const o=t[0]==null?n():t[0],i=t[1];return rt(s(F(i,"$reduce")?i.$reduce(r,o):rs(i)?ro(r,o,i):oo(r,o,i)))}const ro=(t,e,n)=>{for(let s=0,r=n.length;s<r;s++)if(e=t(e,n[s]),G(e)){e=e.deref();break}return e},oo=(t,e,n)=>{for(let s of n)if(e=t(e,s),G(e)){e=e.deref();break}return e},is=(t,e)=>[t,n=>n,e];function as(t){return t?[...t]:is(()=>[],(e,n)=>(e.push(n),e))}function*cs(t,e){const n=qt(t)(as()),s=n[1],r=n[2];for(let o of e){const i=r([],o);if(G(i)){yield*rt(s(i.deref()));return}i.length&&(yield*i)}yield*rt(s([]))}function*ls(t,e){const n=qt(t)([O,O,(s,r)=>r])[2];for(let s of e){let r=n(z,s);if(G(r)){r=rt(r.deref()),r!==z&&(yield r);return}r!==z&&(yield r)}}const us=(t,e,n=ls)=>{const s=e.length-1;return ke(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function q(t,e){return ke(e)?ls(q(t),e):n=>{const s=n[2];return Oe(n,(r,o)=>s(r,t(o)))}}function hs(...t){return us(hs,t)||(e=>{const n=e[2],s=t[0];let r=t[1]||0;return Oe(e,(o,i)=>n(o,s(r++,i)))})}function fs(t,e,n){return new io(t,e,n)}class io{constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let r=this.from,o=this.to;r<o&&!G(n);r+=s)n=e(n,r);else for(let r=this.from,o=this.to;r>o&&!G(n);r+=s)n=e(n,r);return n}}function ao(t,e){t=t||"";let n=!0;return e?[...e].join(t):is(()=>"",(s,r)=>(s=n?s+r:s+t+r,n=!1,s))}function ds(t,e){return ke(e)?cs(ds(t),e):n=>{const s=n[2];let r=t;return Oe(n,(o,i)=>--r>0?s(o,i):r===0?os(s(o,i)):eo(o))}}function ps(...t){return co(ps,so,t)}const co=(t,e,n)=>{let s,r;switch(n.length){case 4:r=n[3],s=n[2];break;case 3:r=n[2];break;case 2:return q(o=>t(n[0],n[1],o));default:Te(n.length)}return e(qt(n[0])(n[1]),s,r)};function*lo(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let r=s.next();if(r.done)return;n.push(r.value)}yield n}}const W=(t=0)=>{const e=new Array(5);let n;const s=(...r)=>{const o=e[r[t].length]||n;return o?o(...r):ve(`no impl for vec size ${r[t].length}`)};return s.add=(r,o)=>e[r]=o,s.default=r=>n=r,s.impl=r=>e[r]||n,s},uo="o,a,b",ho="o,a,n",fo="o,a,b,n",po="io=0,ia=0,so=1,sa=1",mo="!o&&(o=[]);",_o=t=>([e,n,s])=>`${e}=${n}${t}${s};`,bo=t=>([e,n])=>`${e}=${n}${t}n;`,go=(t="op")=>([e,n,s])=>`${e}=${t}(${n},${s});`,ms=([t,e])=>`${t}*${e}`,yo=([t,e])=>`s+=${t}*${e};`,wo=([t,e])=>`${t}=${e};`,So=([t,e,n])=>`${t}=${e}+(${n}-${e})*n;`,Io=t=>e=>e>1?`${t}[i${t}+${e}*s${t}]`:e==1?`${t}[i${t}+s${t}]`:`${t}[i${t}]`,Eo=t=>q(Io(t),fs()),vo=t=>q(e=>`${t}[${e}]`,fs()),_s=(t,e,n,s="a",r="",o="",i="",a=!1)=>[o,ps(ss(ds(t),hs((c,l)=>e(l,c))),ao(r),lo.apply(null,n.split(",").map(a?Eo:vo))),i,s!==""?`return ${s};`:""],Ao=(t,e,n="a",s,r,o=!1)=>[s,"for(let i=a.length;--i>=0;) {",t(e.split(",").map(o?i=>`${i}[i${i}+i*s${i}]`:i=>`${i}[i]`)),"}",r,n!==null?`return ${n};`:""],Mo=(t,e)=>`!${t} && (${t}=${e.split(",")[1]});`,dt=(t,e,n,s=n,r="a",o,i,a,c=!1)=>new Function(n,_s(t,e,s,r,o,i,a,c).join("")),Do=(t,e,n,s,r,o=r,i="a",a="",c,l,u=!1)=>new Function(s,`return (${r})=>{${_s(t,n,o,i,a,c,l,u).join("")}}`)(...e),Wt=(t,e,n=e,s="a",r,o,i=!1)=>new Function(e,Ao(t,n,s,r,o,i).join("")),pt=(t,e=uo,n,s="o",r=1,o)=>{n=n||e,o=o??Mo(s,e);const i=W(r),a=c=>i.add(c,dt(c,t,e,n,s,"",o));return i.default(Wt(t,e,n,s,o)),[i,a(2),a(3),a(4)]},bs=t=>pt(_o(t)),gs=t=>pt(bo(t),ho),Pe=t=>dt(t,ms,`o,a,${po}`,"o,a","","+","return ",";",!0);Pe(2);const re=Pe(3);Pe(4);const ys=(t,e,n,s=!1)=>{const r=re(e,n,0,0,3),o=re(e,n,1,0,3),i=re(e,n,2,0,3),a=V(n[3]);return s?x(t||n,N(r),N(o),N(i),a):x(t||n,r,o,i,a)},To=(t,e)=>ys(t,Br,e),oe=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},ws=(t,e,n=Yn)=>{const s=(e[0]+.16)/1.16;return x(t||e,oe(e[1]/5+s)*n[0],oe(s)*n[1],oe(s-e[2]/2)*n[2],V(e[3]))},Ss=(t,e)=>ws(t,e,zr),ko=(t,e)=>Qr(t,To(t,Ss(t,e))),Oo=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Po=t=>(t%=R,t<0?R+t:t),Co=(t,e)=>Po(Math.atan2(t,e)),Ro=(t,e)=>{let{1:n,2:s}=e;s*=R;const r=V(e[3]);return n>0?x(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,r):x(t||e,e[0],0,0,r)},Is=(t,e,n=jr)=>ys(t,n,e),$o=(t,e)=>Is(t,e,Ur),dn=(t,e)=>Is(null,ws(t,e)),No=(t,e)=>$o(null,Ss(t,e)),Lo=t=>es("lch",t,100),Fo=t=>ts("oklab",t,1),Vo=t=>es("oklch",t,1),ie=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,vt=(t,e)=>x(t||e,ie(e[0]),ie(e[1]),ie(e[2]),V(e[3])),ae=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,nt=t=>{const e=ae(t[0]),n=ae(t[1]),s=ae(t[2]),r=V(t[3]);return r<1?`rgba(${e},${n},${s},${L(r)})`:`#${Qn(e<<16|n<<8|s)}`},Ho=t=>nt(vt([],t)),Es={abgr32:t=>_e(Kr(t[0])),argb32:t=>_e(t[0]),hsl:Kn,hsv:Xr,lab50:t=>nt(vt(null,dn([],t))),lab65:t=>nt(vt(null,No([],t))),lch:t=>nt(vt(null,dn(null,Ro([],t)))),rgb:Ho,srgb:nt};({...Es});const jo=(t,e=Es)=>{let n;return K(t)?t:ct(t)?_e(t):t.mode?(n=e[t.mode])?n(t):e.rgb(Lr([],t,"rgb",t.mode)):nt(t)},Ce=jo,vs=(t,e)=>K(e)?e[0]==="$"?t.grads[e.substring(1)]:e:Ce(e),Uo=(t,{from:e,to:n},s)=>{const r=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let o of s)r.addColorStop(o[0],Ce(o[1]));return r},Bo=(t,{from:e,to:n,r1:s,r2:r},o)=>{const i=t.createRadialGradient(e[0],e[1],s,n[0],n[1],r);for(let a of o)i.addColorStop(a[0],Ce(a[1]));return i},zo=(t,e,{width:n,height:s},r,o,i,a)=>{if(F(r,"toImageData")&&(r=r.toImageData()),r instanceof ImageData){t.putImageData(r,o[0],o[1]);return}n=n||r.width,s=s||r.height,i?t.drawImage(r,i[0],i[1],a?a[0]:n,a?a[1]:s,o[0],o[1],n,s):t.drawImage(r,o[0],o[1],n,s)},xo={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},As={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},pn=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),Go=(t,e,n)=>{let s;if(n){Wo(t,n)&&(s=pn(e,!0));for(let r in n){const o=As[r];if(o){const i=n[r];i!=null&&e.attribs[r]!==i&&(!s&&(s=pn(e)),s.attribs[r]=i,s.edits.push(r),Ms(t,e,r,o,i))}else(r==="__background"||r==="__clear")&&(t.save(),t.resetTransform(),r==="__clear"?n[r]&&t.clearRect(0,0,t.canvas.width,t.canvas.height):(t.fillStyle=vs(e,n[r]),t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.restore())}return s}},qo=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,r=e.attribs;for(let o=s.length;o-- >0;){const i=s[o],a=r[i];Ms(t,e,i,As[i],a??xo[i])}},mn=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},Ms=(t,e,n,s,r)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=vs(e,r);break;case"dash":t[s].call(t,r);break;case"clip":break;default:t[s]=r}},Wo=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(rs(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},ce=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},Xo=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:r}of n)t.moveTo(s[0],s[1]),t.lineTo(r[0],r[1]);t.stroke()}},Jo=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&_n(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&_n(t,n,s,"stroke","strokeRect")},_n=(t,e,n,s,r)=>{const{start:o,cstride:i,estride:a,size:c}={start:0,cstride:1,estride:2,size:1,...e};let l=e&&e.num!=null?e.num:(n.length-o)/a|0;if(e.shape==="circle")for(let u=o;l-- >0;u+=a)t.beginPath(),t.arc(n[u],n[u+i],c,0,R),t[s]();else{const u=c/2;for(let p=o;l-- >0;p+=a)t[r](n[p]-u,n[p+i]-u,c,c)}},Ds=(t,e,n)=>{t.beginPath();let s=[0,0];for(let r=0,o=n.length;r<o;r++){const i=n[r];let a=i[1],c,l;switch(i[0]){case"m":a=[s[0]+a[0],s[1]+a[1]];case"M":t.moveTo(a[0],a[1]),s=a;break;case"l":a=[s[0]+a[0],s[1]+a[1]];case"L":t.lineTo(a[0],a[1]),s=a;break;case"h":a=[s[0]+a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"H":a=[a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"v":a=[s[0],s[1]+a],t.lineTo(a[0],a[1]),s=a;break;case"V":a=[s[0],a],t.lineTo(a[0],a[1]),s=a;break;case"c":c=i[2],l=i[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+a[0],s[1]+a[1],s[0]+c[0],s[1]+c[1],l[0],l[1]),s=l;break;case"C":c=i[2],l=i[3],t.bezierCurveTo(a[0],a[1],c[0],c[1],l[0],l[1]),s=l;break;case"q":c=i[2],c=[s[0]+c[0],s[1]+c[1]],t.quadraticCurveTo(s[0]+a[0],s[1]+a[1],c[0],c[1]),s=c;break;case"Q":c=i[2],t.quadraticCurveTo(a[0],a[1],c[0],c[1]),s=c;break;case"a":c=i[2],c=[s[0]+c[0],s[1]+c[1]],t.arcTo(s[0]+a[0],s[1]+a[1],c[0],c[1],i[3]),s=c;break;case"A":c=i[2],t.arcTo(a[0],a[1],c[0],c[1],i[3]),s=c;break;case"z":case"Z":t.closePath()}}xt(t,e)},Zo=(t,e,n,s)=>{let r;(r=e.fill)&&r!=="none"&&bn(t,n,s,"fill","fillRect"),(r=e.stroke)&&r!=="none"&&bn(t,n,s,"stroke","strokeRect")},bn=(t,e,n,s,r)=>{const o=e&&e.size||1;if(e.shape==="circle")for(let i of n)t.beginPath(),t.arc(i[0],i[1],o,0,R),t[s]();else{const i=o/2;for(let a of n)t[r](a[0]-i,a[1]-i,o,o)}},Yo=(t,e,n)=>{n.length<2||(Ts(t,n),t.closePath(),xt(t,e))},Ts=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,r=e.length;s<r;s++)n=e[s],t.lineTo(n[0],n[1])},Ko=(t,e,n)=>{n.length<2||e.stroke=="none"||(Ts(t,n),t.stroke())},Qo=(t,e,n,s,r,o=0)=>{let i;if(o>0)return o=Math.min(Math.min(s,r)/2,o),s-=2*o,r-=2*o,Ds(t,e,[["M",[n[0]+o,n[1]]],["h",s],["a",[o,0],[o,o],o],["v",r],["a",[0,o],[-o,o],o],["h",-s],["a",[-o,0],[-o,-o],o],["v",-r],["a",[0,-o],[o,-o],o]]);(i=e.fill)&&i!=="none"&&t.fillRect(n[0],n[1],s,r),(i=e.stroke)&&i!=="none"&&t.strokeRect(n[0],n[1],s,r)},ti=(t,e,n,s,r)=>{let o;(o=e.fill)&&o!=="none"&&t.fillText(s.toString(),n[0],n[1],r),(o=e.stroke)&&o!=="none"&&t.strokeText(s.toString(),n[0],n[1],r)},Ct=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(F(e,"toHiccup")){Ct(t,e.toHiccup(),n);return}if(Y(e[0])){for(let i of e)Ct(t,i,n);return}const s=e[1];if(s?.__skip)return;const r=Go(t,n,s),o=r?r.attribs:n.attribs;switch(e[0]){case"g":case"defs":ei(t,r,n,e);break;case"linearGradient":mn(n,s.id,Uo(t,s,e[2]));break;case"radialGradient":mn(n,s.id,Bo(t,s,e[2]));break;case"points":Zo(t,o,s,e[2]);break;case"packedPoints":Jo(t,o,s,e[2]);break;case"line":ce(t,o,e[2],e[3]);break;case"lines":Xo(t,o,e[2]);break;case"hline":ce(t,o,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":ce(t,o,[e[2],-1e6],[e[2],1e6]);break;case"polyline":Ko(t,o,e[2]);break;case"polygon":Yo(t,o,e[2]);break;case"path":Ds(t,o,e[2]);break;case"rect":Qo(t,o,e[2],e[3],e[4],e[5]);break;case"circle":un(t,o,e[2],e[3]);break;case"ellipse":$r(t,o,e[2],e[3],e[4],e[5],e[6]);break;case"arc":un(t,o,e[2],e[3],e[4],e[5]);break;case"text":ti(t,o,e[2],e[3],e[4]);break;case"img":zo(t,o,s,e[2],e[3],e[4],e[5])}r&&qo(t,n,r)},ei=(t,e,n,s)=>{const r=s.length,o=s[0]==="g"&&e||n;for(let i=2;i<r;i++)Ct(t,s[i],o)},St="function",ni="string",si={render(t,e,...n){const s={...e};delete s.__diff,delete s.__normalize;const r=window.devicePixelRatio||1;return r!==1&&(!s.style&&(s.style={}),s.style.width=`${s.width}px`,s.style.height=`${s.height}px`,s.width*=r,s.height*=r),["canvas",s,["g",{__impl:ks,__diff:e.__diff!==!1,__normalize:e.__normalize!==!1,__release:e.__release===!0,__serialize:!1,__clear:e.__clear,scale:r!==1?r:null},...n]]}},be=(t,e,n)=>{const s=e.getContext("2d");Ie(!!s,"canvas ctx unavailable");const r=n[1];if(r){if(r.__skip)return;r.__clear!==!1&&s.clearRect(0,0,e.width,e.height)}Ct(s,n)},J=(t,e)=>{if(e==null)return e;if(Y(e)){const n=e[0];if(typeof n===St)return J(t,n.apply(null,[t.ctx,...e.slice(1)]));if(typeof n===ni){const s=e[1];if(s&&s.__normalize===!1)return e;const r=[e[0],s];for(let o=2,i=e.length;o<i;o++){const a=J(t,e[o]);a!=null&&r.push(a)}return r}}else{if(typeof e===St)return J(t,e(t.ctx));if(typeof e.toHiccup===St)return J(t,e.toHiccup(t.ctx));if(typeof e.deref===St)return J(t,e.deref());if(Ee(e)){const n=[];for(let s of e){const r=J(t,s);r!=null&&n.push(r)}return n}}return e},ri=(t,e,n,s,r)=>{const o=s[1];if(o.__skip)return;if(o.__diff===!1)return st(n),be(t,e,s);let i=o.__impl;if(i&&i!==ks)return i.diffTree(t,e,n,s,r);if(Wn(n,s,"only-distance",et).distance>0)return be(t,e,s)},ks={createTree:be,normalizeTree:J,diffTree:ri,hydrateTree:O,getElementById:O,createElement:O,createTextElement:O,replaceChild:O,getChild:O,removeAttribs:O,removeChild:O,setAttrib:O,setContent:O};var Rt;(function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.MIDDLE=4]="MIDDLE"})(Rt||(Rt={}));var T;(function(t){t[t.SHIFT=1]="SHIFT",t[t.CONTROL=2]="CONTROL",t[t.META=4]="META",t[t.ALT=8]="ALT"})(T||(T={}));var S;(function(t){t.ALT="Alt",t.BACKSPACE="Backspace",t.CAPSLOCK="CapsLock",t.CONTEXT_MENU="ContextMenu",t.CONTROL="Control",t.DELETE="Delete",t.DOWN="ArrowDown",t.END="End",t.ENTER="Enter",t.ESC="Escape",t.HELP="Help",t.HOME="Home",t.LEFT="ArrowLeft",t.META="Meta",t.NUM_LOCK="NumLock",t.PAGE_DOWN="PageDown",t.PAGE_UP="PageUp",t.RIGHT="ArrowRight",t.SHIFT="Shift",t.SPACE=" ",t.TAB="Tab",t.UP="ArrowUp"})(S||(S={}));S.ALT,S.BACKSPACE,S.CAPSLOCK,S.CONTEXT_MENU,S.CONTROL,S.DELETE,S.DOWN,S.END,S.ENTER,S.ESC,S.HELP,S.HOME,S.LEFT,S.META,S.NUM_LOCK,S.PAGE_DOWN,S.PAGE_UP,S.RIGHT,S.SHIFT,S.TAB,S.UP;const gn="__NONE__",Os={font:"10px Menlo, monospace",fontSize:10,charWidth:6,baseLine:4,pad:8,globalBg:"#ccc",focus:[0,1,0,1],cursor:[0,0,0,1],cursorBlink:2,bg:[1,1,1,.66],bgDisabled:[1,1,1,.33],bgHover:[1,1,1,.9],fg:[.2,.8,1,1],fgDisabled:[.2,.8,1,.5],fgHover:[.3,.9,1,1],text:[.3,.3,.3,1],textDisabled:[.3,.3,.3,.5],textHover:[.2,.2,.4,1],bgTooltip:[1,1,.8,.85],textTooltip:[0,0,0,1]},oi=ht(()=>"illegal argument(s)"),Ps=t=>{throw new oi(t)},[Mc,$t,Dc,Tc]=bs("+"),Xt=Object.freeze([0,0]),ii=Object.freeze([0,0,0]),Cs=([t,e])=>`t=${t}-${e};s+=t*t;`,Rs="let t,s=0;",Re=t=>Jt.add(t,dt(t,Cs,"a,b",void 0,"s","",Rs)),Jt=W();Jt.default(Wt(Cs,"a,b",void 0,"s",Rs));Re(2);Re(3);Re(4);const[kc,ai,Oc,Pc]=pt(go("Math.max")),[yn,ci,Cc,Rc]=bs("-"),[$c,li,Nc,Lc]=gs("-"),[Fc,ui,Vc,Hc]=gs("+"),[hi,Nt,jc,Uc]=pt(wo,"o,a",void 0,"o",1,mo),wn=Object.getPrototypeOf,Zt=t=>{let e;return t!=null&&typeof t=="object"&&((e=wn(t))===null||wn(e)===null)},fi=(t,e=0)=>new Array(t).fill(e),di=t=>{if(t.length){const e=t[t.length-1];return Zt(e)?t.pop():(e==null&&t.pop(),void 0)}},pi=t=>{const e=di(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]},mi=(t,e=2)=>ct(t)?fi(e,t):t,_i=t=>t instanceof Set,bi=t=>_i(t)?t:new Set(t),gi=(t,e)=>{const n=bi(e),s={};for(let r in t)t.hasOwnProperty(r)&&!n.has(r)&&(s[r]=t[r]);return s},yi=t=>F(t,"copy")?t.copy():hi([],t),wi=t=>t.map(yi),$s=(t,...e)=>{if(!t.attribs)return;const n={...t.attribs};return e.length?gi(n,e):n},Si=(t,e)=>new t(wi(e.points),$s(e));class Lt{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=mi(n)}get type(){return"rect"}copy(){return new Lt(Nt([],this.pos),Nt([],this.size),$s(this))}withAttribs(e){return new Lt(this.pos,this.size,e)}max(){return $t([],this.pos,this.size)}offset(e){return li(null,this.pos,e),ai(null,ui(null,this.size,e*2),Xt),this}toHiccup(){return["rect",this.attribs,this.pos,this.size[0],this.size[1]]}}function ot(...t){return new Lt(...pi(t))}const Yt=new Float64Array(1),Ii=new Float32Array(Yt.buffer),Ei=new Uint8Array(Yt.buffer);new Int32Array(Yt.buffer);const Ns=new Uint32Array(Yt.buffer);Ns[0]=1,Ei[0];const vi=t=>(Ii[0]=t,Ns[0]),Sn=(t,e)=>(t<<e|t>>>32-e)>>>0,At=Math.imul,tt=(t,e=2654435761)=>{let n=-1;for(let s=t.length;s-- >0;)n=At(e,n)+Ti(n,vi(t[s]))>>>0;return n},Ai=3432918353,Mi=461845907,Di=3864292196,Ti=(t,e)=>(e=At(Sn(At(e,Ai)>>>0,15),Mi)>>>0,(At(Sn(t^e,13),5)>>>0)+Di>>>0);var ge;(function(t){t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE"})(ge||(ge={}));const $e=Object.freeze({level:ge.NONE,fine(){},debug(){},info(){},warn(){},severe(){}});let ki=$e;const H=Symbol();function Oi(t,e,n){const s={},r=e?Pi(e):{},o=(...i)=>{const a=t(...i),c=s[a]||at(s,r,a)||s[H];return c?c(...i):ve(`missing implementation for: "${a.toString()}"`)};return o.add=(i,a)=>(s[i]&&ki.warn(`overwriting '${i.toString()}' impl`),s[i]=a,!0),o.addAll=i=>{let a=!0;for(let c in i)a=o.add(c,i[c])&&a;return H in i&&o.setDefault(i[H]),a},o.setDefault=i=>o.add(H,i),o.remove=i=>s[i]?(delete s[i],!0):!1,o.callable=(...i)=>{const a=t(...i);return!!(s[a]||at(s,r,a)||s[H])},o.isa=(i,a)=>{let c=r[i];!c&&(r[i]=c=new Set),c.add(a)},o.impls=()=>{const i=new Map;for(let a in s)i.set(a,s[a]);for(let a in r){const c=at(s,r,a);c&&i.set(a,c)}return s[H]&&i.set(H,s[H]),i},o.implForID=i=>s[String(i)]||at(s,r,i)||s[H],o.rels=()=>r,o.parents=i=>r[i],o.ancestors=i=>new Set(Ls([],r,i)),o.dependencies=function*(){for(let i in r)for(let a of r[i])yield[i,a];for(let i in s)!r[i]&&(yield[i,void 0])},n&&o.addAll(n),o}const at=(t,e,n)=>{const s=e[n];if(s)for(let r of s){let o=t[r]||at(t,e,r);if(o)return o}},Ls=(t,e,n)=>{const s=e[n];if(s)for(let r of s)t.push(r),Ls(t,e,r);return t},Pi=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},Ne=t=>Le.add(t,dt(t,ms,"a,b",void 0,"","+","return ",";")),Le=W();Le.default(Wt(yo,"a,b",void 0,"s","let s=0;"));Ne(2);Ne(3);Ne(4);const Fe=t=>Ve.add(t,dt(t,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),Ve=W();Ve.default(Wt(([t])=>`sum+=${t}*${t};`,"a",void 0,"sum","let sum=0;"));Fe(2);Fe(3);Fe(4);const[Ci,Bc,zc,xc]=pt(So,fo),Ri=(t,e,n)=>{const s=yn([],n,e),r=Ve(s);return r>1e-6?Le(yn([],t,e),s)/r:void 0},$i=(t,e=U)=>t>e?1:t<-e?-1:0,Mt=(t,e,n)=>{const s=t[0],r=t[1];return(e[0]-s)*(n[1]-r)-(n[0]-s)*(e[1]-r)},Ni=(t,e,n,s=U)=>$i(Mt(t,e,n),s),Li=(t,e,n,s=U)=>Ni(t,e,n,s)<0,Fi=(t,e,n,s=U)=>{const r=Ri(t,e,n);return r!==void 0?Jt(t,Ci([],e,n,N(r)))<s*s:!1},Vi=(t,e,n)=>Jt(e,t)<=n*n,Hi=(t,e,n,s)=>{const r=Li(e,n,s)?1:-1;return r*Mt(e,s,t)>=0&&r*Mt(n,e,t)>=0&&r*Mt(s,n,t)>=0},ji=(t,e)=>{const n=e.length-1,s=t[0],r=t[1];let o=e[n],i=e[0],a=0;for(let c=0;c<=n;o=i,i=e[++c])a=Ui(s,r,o[0],o[1],i[0],i[1],a);return a},Ui=(t,e,n,s,r,o,i)=>(s<e&&o>=e||o<e&&s>=e)&&(n<=t||r<=t)?i^~~(n+(e-s)/(o-s)*(r-n)<t):i,He=W(0),Fs=He.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),Bi=He.add(3,([t,e,n],s,r)=>t>=s[0]&&t<=s[0]+r[0]&&e>=s[1]&&e<=s[1]+r[1]&&n>=s[2]&&n<=s[2]+r[2]);He.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],o=e[s];if(r<o||r>o+n[s])return!1}return!0});const je=W(0);je.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);je.add(3,([t,e,n],s,r)=>t>=s[0]-r[0]&&t<=s[0]+r[0]&&e>=s[1]-r[1]&&e<=s[1]+r[1]&&n>=s[2]-r[2]&&n<=s[2]+r[2]);je.default((t,e,n)=>{for(let s=t.length;s-- >0;){const r=t[s],o=e[s],i=n[s];if(r<o-i||r>o+i)return!1}return!0});const zi=Math.abs,Vs=(t,e,n=U)=>zi(t-e)<=n,Ue=t=>Be.add(t,Do(t,[Vs,U],([e,n])=>`eq(${e},${n},eps)`,"eq,_eps","a,b,eps=_eps","a,b","","&&","return a.length === b.length && ",";")),Be=W();Be.default((t,e,n=U)=>F(t,"eqDelta")?t.eqDelta(e,n):F(e,"eqDelta")?e.eqDelta(t,n):xi(t,e,t.length,n));Ue(2);Ue(3);Ue(4);const xi=(t,e,n,s=U,r=0,o=0,i=1,a=1)=>{for(;n>0;n--,r+=i,o+=a)if(!Vs(t[r],e[o],s))return!1;return!0},Gi=(t,e,n=U)=>{for(let s=e.length;s-- >0;)if(Be(t,e[s],n))return!0;return!1},qi=t=>t.type,Hs=Oi(qi,{points3:"points",quad:"poly",sphere:"circle"},{aabb:(t,e)=>Bi(e,t.pos,t.size),circle:(t,e)=>Vi(e,t.pos,t.r),line:(t,e)=>Fi(e,t.points[0],t.points[1]),points:({points:t},e)=>Gi(e,t),poly:(t,e)=>ji(e,t.points)>0,rect:(t,e)=>Fs(e,t.pos,t.size),tri:(t,e)=>Hi(e,...t.points)}),Wi=new Array(1024),Xi=(t,e=Wi)=>{const n=e.length=t.length;for(let s=0;s<n;s++)e[s]=t.charCodeAt(s);return e},Ji=t=>tt(Xi(t)),js=(t,e)=>t^Ji(e),Zi=(t,e,n)=>js(t+~~n,e),Us=(t,e,n)=>js(t+~~n,String(e)),ze=t=>F(t,"next"),mt=(t,e)=>ze(t)?t.next(e):t,le=(t,e,n,s=!1)=>{const r=t.theme,{x:o,y:i,h:a}=mt(e);t.draw&&t.add(["text",{fill:t.textColor(!1)},[o+(s?r.pad:0),i+a/2+r.baseLine],n])},_t=(t,e,n)=>["text",Zt(e)?e:{fill:e},t,n],In=(t,e,n,s,r)=>[1,0,0,1,e+t.pad,n+r/2+t.baseLine],ye=(t,e,n,s,r)=>[0,-1,1,0,e+s/2+t.baseLine,n+r-t.pad],Yi=(t,e,n,s,r,o,i,a)=>t.resource(e,Us(n,s,t.disabled),()=>_t([r,o],t.textColor(!1),(i?i+" ":"")+(a?a(s):s))),xe=(t,e)=>{const n=t.theme,s=$t(null,[0,10],t.mouse);t.addOverlay(ot(s,[e.length*n.charWidth+n.pad,20],{fill:n.bgTooltip}),_t($t(null,[4,10+n.baseLine],s),n.textTooltip,e))},Bs=(t,e,n,s)=>{if(t.disabled)return!1;const r=t.activeID,o=(r===""||r===e)&&Hs(n,t.mouse);return o&&(t.setCursor("pointer"),t.hotID=e,t.isMouseDown()&&(t.activeID=e),s&&t.draw&&xe(t,s)),o},zs=t=>{switch(t.key){case S.TAB:t.switchFocus();break;case S.ENTER:case S.SPACE:return!0}},Ft=(t,e,n,s,r,o,i,a,c,l)=>t.resource(n,Zi(s,l,t.disabled),()=>_t(Xt,{transform:e(t.theme,r,o,i,a),fill:t.textColor(c)},l)),ue=(t,e,n,s,r=s,o)=>{const{x:i,y:a,w:c,h:l}=mt(e),u=tt([i,a,c,l]);return xs(t,n,t.resource(n,u,()=>ot([i,a],[c,l])),u,s?Ft(t,In,n,u,i,a,c,l,!1,s):void 0,r?Ft(t,In,n,u,i,a,c,l,!0,r):void 0,o)},Ki=(t,e,n,s,r,o=r,i)=>{const{x:a,y:c,w:l,h:u}=mt(e,[1,s]),p=tt([a,c,l,u]);return xs(t,n,t.resource(n,p,()=>ot([a,c],[l,u])),p,r?Ft(t,ye,n,p,a,c,l,u,!1,r):void 0,o?Ft(t,ye,n,p,a,c,l,u,!0,o):void 0,i)},xs=(t,e,n,s,r,o,i)=>{t.registerID(e,s);const a=Bs(t,e,n,i),c=t.requestFocus(e);return t.draw&&(n.attribs={fill:a?t.fgColor(!0):t.bgColor(c),stroke:t.focusColor(e)},t.add(n),r&&t.add(a&&o?o:r)),c&&zs(t)?!0:(t.lastID=e,!t.buttons&&t.hotID===e&&t.activeID===e)};function*Qi(t,e=!0){if(t>0)for(let n=0,s=e?t+1:t;n<s;n++)yield n/t}const En=Math.cos,vn=Math.sin,Gs=W(1),ta=Gs.add(2,(t,e,n=Xt)=>$t(t||e,Oo(e[1],e[0]),n));Gs.add(3,(t,e,n=ii)=>{const s=e[0],r=e[1],o=e[2],i=En(r);return Gr(t||e,s*i*En(o)+n[0],s*i*vn(o)+n[1],s*vn(r)+n[2])});const ea=t=>((t==null||!t[Symbol.iterator])&&Ps(`value is not iterable: ${t}`),t),na=t=>Y(t)?t:[...ea(t)];class sa{constructor(e,n){this.attribs=n,this.points=e?na(e):[]}*[Symbol.iterator](){yield*this.points}clear(){this.points.length=0}}class Vt extends sa{get type(){return"poly"}add(...e){this.points.push(...e)}copy(){return Si(Vt,this)}withAttribs(e){return new Vt(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}const qs=(t,e)=>new Vt(t,e),ra=[1,1];class Ge{constructor(e,n,s,r,o,i,a){this.parent=e,this.cols=o,this.x=n,this.y=s,this.width=r,this.cellW=(r-(o-1)*a)/o,this.cellH=i,this.cellWG=this.cellW+a,this.cellHG=i+a,this.gap=a,this.currCol=0,this.currRow=0,this.rows=0}colsForWidth(e){return Math.ceil(e/this.cellWG)}rowsForHeight(e){return Math.ceil(e/this.cellHG)}spansForSize(e,n){const s=ct(e)?[e,n]:e;return[this.colsForWidth(s[0]),this.rowsForHeight(s[1])]}next(e=ra){const{cellWG:n,cellHG:s,gap:r,cols:o}=this,i=Math.min(e[0],o),a=e[1];this.currCol>0?this.currCol+i>o&&(this.currCol=0,this.currRow=this.rows):this.currRow=this.rows;const c=a*s-r,l={x:this.x+this.currCol*n,y:this.y+this.currRow*s,w:i*n-r,h:c,cw:this.cellW,ch:this.cellH,gap:r};return this.propagateSize(a),this.currCol=Math.min(this.currCol+i,o)%o,l}nextSquare(){const e=this.next([1,Math.ceil(this.cellW/(this.cellH+this.gap))+1]);return e.h=e.w,e}nest(e,n){const{x:s,y:r,w:o}=this.next(n);return new Ge(this,s,r,o,e,this.cellH,this.gap)}propagateSize(e){let n=this.rows;this.rows=n=Math.max(n,this.currRow+e);const s=this.parent;s&&s.propagateSize(n)}}const Ws=(t,e,n,s=1,r=16,o=4)=>new Ge(null,t,e,n,s,r,o),An=(t,e,n,s,r,o,i)=>{const a=t.state(n,()=>!1),c=ze(e)?e.nest(1,[1,a?r.length:1]):Ws(e.x,e.y,e.w,1,e.ch,e.gap);let l;const u=c.next(),{x:p,y:h,w:d,h:f}=u,m=tt([p,h,d,f,~~t.disabled]),_=p+d-t.theme.pad-4,b=h+f/2,w=t.draw;if(a){const g=ue(t,u,`${n}-title`,o);if(w&&t.add(t.resource(n,m+1,()=>Dn(t,_,b,!0))),g)t.setState(n,!1);else{for(let y=0,I=r.length;y<I;y++)ue(t,c,`${n}-${y}`,r[y])&&(y!==s&&(l=y),t.setState(n,!1));if(t.focusID.startsWith(`${n}-`))switch(t.key){case S.ESC:t.setState(n,!1);break;case S.UP:return Mn(t,n,Ot(s-1));case S.DOWN:return Mn(t,n,Math.min(r.length-1,s+1))}}}else ue(t,u,`${n}-${s}`,r[s],o,i)&&t.setState(n,!0),w&&t.add(t.resource(n,m+2,()=>Dn(t,_,b,!1)));return l},Mn=(t,e,n)=>(t.focusID=`${e}-${n}`,n),Dn=(t,e,n,s)=>{const r=s?2:-2;return qs([[e-4,n+r],[e+4,n+r],[e,n-r]],{fill:t.textColor(!1)})},Kt=(t,e,n)=>n!==e?(t-e)/(n-e):0,Xs=(t,e,n,s,r)=>s+(r-s)*Kt(t,e,n),oa=(t,e,n,s,r)=>s+(r-s)*N(Kt(t,e,n)),ia=(t,e,n)=>t+(e-t)*n,aa=t=>Co(t[1],t[0]),ca=aa,la=(t,e,n,s="ew-resize")=>{if(t.disabled)return!1;const r=t.activeID,o=r===e||r===""&&Hs(n,t.mouse);return o&&(t.setCursor(s),t.hotID=e),o},qe=(t,e,n,s)=>Et(Fr(t,s),e,n),Js=(t,e,n,s,r)=>{switch(t.key){case S.TAB:t.switchFocus();break;case S.UP:case S.DOWN:{const o=(t.key===S.UP?s:-s)*(t.isShiftDown()?5:1);return qe(r+o,e,n,s)}}},ua=(t,e,n,s,r,o,i)=>{let a=ca(ci([],t,e))-n;return a<-.5&&(a+=R),qe(Xs(Math.min(a/(R-s)),0,1,r,o),r,o,i)},Tn=(t,e)=>t/2*(1+Math.sin(pe+e/2)),kn=(t,e,n,s,r=12)=>e>1?q(o=>ta(null,[e,ia(n,s,o)],t),Qi(Math.max(1,Math.abs(s-n)/(zt/r))|0)):[t],ha=(t,e,n,s,r,o,i,a,c,l,u,p)=>{let h,d;return ze(e)?(h=Tn(e.cellW,a),d=e.next([1,e.rowsForHeight(h)+1])):(h=Tn(e.cw,a),d=e),fa(t,n,d.x,d.y,d.w,h,s,r,o,i,a,c,0,h+d.ch/2+t.theme.baseLine,l,u,p)},fa=(t,e,n,s,r,o,i,a,c,l,u,p,h,d,f,m,_)=>{const b=r/2,w=tt([n,s,b]);t.registerID(e,w);const g=[n+b,s+b],y=pe+u/2,I=pe+R-u/2,v=t.draw,E=t.activeID,k=!t.disabled&&(E===e||E===""&&Fs(t.mouse,[n,s],[r,o]));let M=l,X;k&&(t.setCursor("pointer"),t.hotID=e,t.isMouseDown()&&(t.activeID=e,X=ua(t.mouse,g,y,u,i,a,c)),_&&v&&xe(t,_));const Ze=t.requestFocus(e);if(v){const rr=y+(R-u)*Kt(M,i,a),or=b*p,Ye=oa(b,15,80,12,30),Ke=tn=>()=>qs([...kn(g,b,y,tn,Ye),...kn(g,or,tn,y,Ye)],{}),ee=t.resource(e,w,Ke(I)),Qe=t.resource(e,M,Ke(rr)),ir=Yi(t,e,w,M,n+h,s+d,f,m);ee.attribs.fill=t.bgColor(k||Ze),ee.attribs.stroke=t.focusColor(e),Qe.attribs.fill=t.fgColor(k),t.add(ee,Qe,ir)}return Ze&&(M=Js(t,i,a,c,M))!==void 0?M:(t.lastID=e,X)},da=(t,e,n,s,r,o,i,a,c,l,u)=>{const p=mt(e,[1,a]);return pa(t,n,p.x,p.y,p.w,p.h,s,r,o,i,c,l,u)},pa=(t,e,n,s,r,o,i,a,c,l,u,p,h)=>{const d=t.theme,f=tt([n,s,r,o]);t.registerID(e,f);const m=t.resource(e,f,()=>ot([n,s],[r,o],{})),_=s+o,b=la(t,e,m,"ns-resize"),w=t.draw;let g=l,y;b&&(t.isMouseDown()&&(t.activeID=e,y=qe(Xs(t.mouse[1],_-1,s,i,a),i,a,c)),h&&w&&xe(t,h));const I=t.requestFocus(e);if(w){const v=t.resource(e,g,()=>{const k=Kt(g,i,a)*(o-1);return ot([n,_-k],[r,k],{})}),E=t.resource(e,Us(f,g,t.disabled),()=>_t(Xt,{transform:ye(d,n,s,r,o),fill:t.textColor(!1)},(u?u+" ":"")+(p?p(g):g)));v.attribs.fill=t.fgColor(b),m.attribs.fill=t.bgColor(b||I),m.attribs.stroke=t.focusColor(e),t.add(m,v,E)}return I&&(g=Js(t,i,a,c,g))!==void 0?g:(t.lastID=e,y)};class ma{constructor(e){this.mouse=[-1e3,-1e3],this.prevMouse=[-1e3,-1e3],this.key=this.prevKey="",this.buttons=this.prevButtons=this.modifiers=this.prevModifiers=0,this.hotID=this.activeID=this.focusID=this.lastID="",this.currIDs=new Set,this.prevIDs=new Set,this.resources=new Map,this.sizes=new Map,this.states=new Map,this.layers=[[],[]],this.attribs={},this.disabledStack=[!1],this.setTheme(e.theme||{}),this.draw=!0,this.t0=Date.now()}get theme(){const e=this.themeStack;return e[e.length-1]}get disabled(){const e=this.disabledStack;return e[e.length-1]}clear(){this.layers[0].length=0,this.layers[1].length=0,this.themeStack.length=1,this.disabledStack.length=1}setMouse(e,n){return Nt(this.prevMouse,this.mouse),Nt(this.mouse,e),this.prevButtons=this.buttons,this.buttons=n,this}setKey(e){return e.type==="keydown"&&(this.prevKey=this.key,this.key=e.key),this.prevModifiers=this.modifiers,this.modifiers=~~e.shiftKey*T.SHIFT|~~e.ctrlKey*T.CONTROL|~~e.metaKey*T.META|~~e.altKey*T.ALT,this}setTheme(e){this.themeStack=[{...Os,...e}]}beginTheme(e){const n=this.themeStack;n.push({...n[n.length-1],...e})}endTheme(){On(this.themeStack)}withTheme(e,n){this.beginTheme(e);const s=n();return this.themeStack.pop(),s}beginDisabled(e=!0){this.disabledStack.push(e)}endDisabled(){On(this.disabledStack)}withDisabled(e,n){this.disabledStack.push(e);const s=n();return this.disabledStack.pop(),s}requestFocus(e){return this.disabled?!1:this.focusID===""||this.activeID===e?(this.focusID=e,!0):this.focusID===e}switchFocus(){this.focusID=this.isShiftDown()?this.lastID:"",this.key=""}isMouseDown(){return(this.buttons&Rt.LEFT)>0}isShiftDown(){return(this.modifiers&T.SHIFT)>0}isControlDown(){return(this.modifiers&T.CONTROL)>0}isMetaDown(){return(this.modifiers&T.META)>0}isAltDown(){return(this.modifiers&T.ALT)>0}isPrevMouseDown(){return(this.prevButtons&Rt.LEFT)>0}isPrevShiftDown(){return(this.prevModifiers&T.SHIFT)>0}isPrevControlDown(){return(this.prevModifiers&T.CONTROL)>0}isPrevMetaDown(){return(this.prevModifiers&T.META)>0}isPrevAltDown(){return(this.prevModifiers&T.ALT)>0}begin(e=!0){this.hotID="",this.cursor="default",this.draw=e,this.clear(),this.time=(Date.now()-this.t0)*.001}end(){this.buttons?this.activeID===""&&(this.activeID=gn,this.focusID=gn,this.lastID=""):this.activeID="",this.key===S.TAB&&(this.focusID=""),this.key="",this.gc()}gc(){const{currIDs:e,prevIDs:n}=this;for(let s of n)e.has(s)||(this.resources.delete(s),this.sizes.delete(s),this.states.delete(s));this.prevIDs=e,this.currIDs=n,n.clear()}bgColor(e){return this.disabled?this.theme.bgDisabled:e?this.theme.bgHover:this.theme.bg}fgColor(e){return this.disabled?this.theme.fgDisabled:e?this.theme.fgHover:this.theme.fg}textColor(e){return this.disabled?this.theme.textDisabled:e?this.theme.textHover:this.theme.text}focusColor(e){return this.focusID===e?this.theme.focus:void 0}textWidth(e){return this.theme.charWidth*e.length}registerID(e,n){this.currIDs.add(e),this.sizes.get(e)!==n&&(this.sizes.set(e,n),this.resources.delete(e))}resource(e,n,s){let r,o=this.resources.get(e);return!o&&this.resources.set(e,o=new Map),o.get(n)||(o.set(n,r=s()),r)}state(e,n){let s=this.states.get(e);return s!==void 0||this.states.set(e,s=n()),s}setState(e,n){this.states.set(e,n)}setCursor(e){this.cursor=e}add(...e){this.layers[0].push(...e)}addOverlay(...e){this.layers[1].push(...e)}toHiccup(){return["g",{font:this.theme.font},...this.layers[0],...this.layers[1]]}}const On=t=>t.length>1&&t.pop(),_a=t=>typeof t=="boolean";let ba=0;const Zs=()=>ba++,Z=(t,e)=>!e||!e.id?{...e,id:t+"-"+Zs()}:e,Ys=t=>typeof t=="function";var A;(function(t){t[t.IDLE=0]="IDLE",t[t.ACTIVE=1]="ACTIVE",t[t.DONE=2]="DONE",t[t.UNSUBSCRIBED=3]="UNSUBSCRIBED",t[t.ERROR=4]="ERROR"})(A||(A={}));var $;(function(t){t[t.NEVER=0]="NEVER",t[t.FIRST=1]="FIRST",t[t.LAST=2]="LAST"})($||($={}));let j=$e;const ga=t=>t[t.length-1];class it{constructor(e,n){this.wrapped=e,this.last=z,this.state=A.IDLE,this.subs=[],n=Z("sub",{closeIn:$.LAST,closeOut:$.LAST,cache:!0,...n}),this.parent=n.parent,this.id=n.id,this.closeIn=n.closeIn,this.closeOut=n.closeOut,this.cacheLast=n.cache,n.xform&&(this.xform=n.xform(as()))}deref(){return this.last!==z?this.last:void 0}getState(){return this.state}setState(e){this.state=e}subscribe(e,n={}){this.ensureState();let s;return e instanceof it&&!n.xform?(e.ensureState(),Ie(!e.parent,`sub '${e.id}' already has a parent`),e.parent=this,s=e):s=new it(e,{...n,parent:this}),this.subs.push(s),this.setState(A.ACTIVE),s.setState(A.ACTIVE),this.last!=z&&s.next(this.last),s}transform(...e){let n,s;return Zt(ga(e))&&(s=e.pop(),n={error:s.error}),this.subscribe(n,Z("xform",e.length>0?{...s,xform:ss(...e)}:s))}map(e,n){return this.transform(q(e),n||{})}unsubscribe(e){return e?this.unsubscribeChild(e):this.unsubscribeSelf()}unsubscribeSelf(){return j.debug(this.id,"unsub self"),this.parent&&this.parent.unsubscribe(this),this.state<A.UNSUBSCRIBED&&(this.state=A.UNSUBSCRIBED),this.release(),!0}unsubscribeChild(e){j.debug(this.id,"unsub child",e.id);const n=this.subs.indexOf(e);return n>=0?(this.subs.splice(n,1),(this.closeOut===$.FIRST||!this.subs.length&&this.closeOut!==$.NEVER)&&this.unsubscribe(),!0):!1}next(e){this.state>=A.DONE||(this.xform?this.dispatchXform(e):this.dispatch(e))}done(){j.debug(this.id,"entering done()"),!(this.state>=A.DONE)&&(this.xform&&!this.dispatchXformDone()||(this.state=A.DONE,this.dispatchTo("done")&&this.state<A.UNSUBSCRIBED&&this.unsubscribe(),j.debug(this.id,"exiting done()")))}error(e){const n=this.wrapped,s=n&&n.error;return s&&j.debug(this.id,"attempting wrapped error handler"),s&&n.error(e)||this.unhandledError(e)}unhandledError(e){return(j!==$e?j:console).warn(this.id,"unhandled error:",e),this.unsubscribe(),this.state=A.ERROR,!1}dispatchTo(e,n){let s=this.wrapped;if(s)try{s[e]&&s[e](n)}catch(o){if(!this.error(o))return!1}const r=e==="next"?this.subs:[...this.subs];for(let o=r.length;o-- >0;){s=r[o];try{s[e]&&s[e](n)}catch(i){if(e==="error"||!s.error||!s.error(i))return this.unhandledError(i)}}return!0}dispatch(e){j.debug(this.id,"dispatch",e),this.cacheLast&&(this.last=e),this.dispatchTo("next",e)}dispatchXform(e){let n;try{n=this.xform[2]([],e)}catch(s){this.error(s);return}this.dispatchXformVals(n)&&G(n)&&this.done()}dispatchXformDone(){let e;try{e=this.xform[1]([])}catch(n){return this.error(n)}return this.dispatchXformVals(e)}dispatchXformVals(e){const n=rt(e);for(let s=0,r=n.length;s<r&&this.state<A.DONE;s++)this.dispatch(n[s]);return this.state<A.ERROR}ensureState(){this.state>=A.DONE&&jn(`operation not allowed in state ${this.state}`)}release(){this.subs.length=0,delete this.parent,delete this.xform,delete this.last}}function We(t,e){return new ya(t,e)}class ya extends it{constructor(e,n){const[s,r]=Ys(e)?[e,n||{}]:[void 0,e||{}];super(r.error?{error:r.error}:void 0,Z("stream",r)),this.src=s,this._inited=!1}subscribe(e,n={}){const s=super.subscribe(e,n);if(!this._inited){if(this.src)try{this._cancel=this.src(this)||(()=>{})}catch(r){let o=this.wrapped;(!o||!o.error||!o.error(r))&&this.unhandledError(r)}this._inited=!0}return s}unsubscribe(e){const n=super.unsubscribe(e);return n&&(!e||(!this.subs||!this.subs.length)&&this.closeOut!==$.NEVER)&&this.cancel(),n}done(){this.cancel(),super.done(),delete this.src,delete this._cancel}error(e){return super.error(e)?!0:(this.cancel(),!1)}cancel(){if(this._cancel){j.debug(this.id,"cancel");const e=this._cancel;delete this._cancel,e()}}}const wa=(t,e,n=!1,s)=>We(r=>{let o=i=>r.next(i);return t.addEventListener(e,o,n),()=>t.removeEventListener(e,o,n)},Z(`event-${e}`,s)),we=(t,e,n=!1,s)=>wa(t,e,n,s),Sa=(t,e)=>t===$.FIRST||t===$.LAST&&!e,Ia=(t,e)=>{let n=!0;for(let s of e)n=t.removeID(s)&&n;return n},Ea=t=>new va(t);class va extends it{constructor(e){e=e||{},super(void 0,Z("streammerge",e)),this.sources=new Map,e.src&&this.addAll(e.src)}add(e){this.ensureState(),this.sources.set(e,e.subscribe({next:n=>n instanceof it?this.add(n):this.next(n),done:()=>this.markDone(e),__owner:this},{id:`in-${e.id}`}))}addAll(e){for(let n of e)this.add(n)}remove(e){const n=this.sources.get(e);return n?(this.sources.delete(e),n.unsubscribe(),!0):!1}removeID(e){for(let n of this.sources)if(n[0].id===e)return this.remove(n[0]);return!1}removeAll(e){let n=!0;for(let s of e)n=this.remove(s)&&n;return n}removeAllIDs(e){return Ia(this,e)}unsubscribe(e){if(!e){for(let n of this.sources.values())n.unsubscribe();this.state=A.DONE,this.sources.clear()}return super.unsubscribe(e)}markDone(e){this.remove(e),Sa(this.closeIn,this.sources.size)&&this.done()}}const Aa=new Set(["mousedown","touchmove","touchstart","mousemove"]),Ma=new Set(["mouseup","touchend","touchcancel"]),Da=["mousemove","mousedown","touchstart","wheel"],Ta={touchstart:"start",touchmove:"drag",touchend:"end",touchcancel:"end",mousedown:"start",mouseup:"end",wheel:"zoom"},ka=(t,e)=>{const n={zoom:1,absZoom:!0,minZoom:.25,maxZoom:4,smooth:1,eventOpts:{capture:!0},preventDefault:!0,preventScrollOnZoom:!0,preventContextMenu:!0,local:!0,scale:!1,...e};n.id=n.id||`gestures-${Zs()}`;const s=[];let r=Et(ct(n.zoom)?n.zoom:n.zoom.deref()||1,n.minZoom,n.maxZoom),o=0,i=0,a=[0,0],c;const l=t===document.body,u=["touchend","touchcancel","touchmove","mouseup"];!l&&u.push("mousemove"),n.preventContextMenu&&t.addEventListener("contextmenu",m=>m.preventDefault());const p=(m,_,b,w)=>{const g=m==="mousedown"||m==="touchstart";for(let y of _){const I=y.identifier||0,v=Pn(y,b,n.local,n.scale);let E=s.find(k=>k.id===I);!E&&g&&(E={id:I,start:v},s.push(E),i++),E&&(E.pos=v,E.delta=[v[0]-E.start[0],v[1]-E.start[1]],w&&(E.force=y.force))}g&&!c&&(c=u.map(y=>he(document.body,y,n,"-temp")),f.addAll(c),!l&&f.removeID("mousemove"))},h=m=>{for(let _ of m){const b=_.identifier||0,w=s.findIndex(g=>g.id===b);w!==-1&&(s.splice(w,1),i--)}i===0&&(f.removeAll(c),!l&&f.add(he(t,"mousemove",n)),c=void 0)},d=m=>{const _=n.smooth*("wheelDeltaY"in m?-m.wheelDeltaY/120:m.deltaY/40);r=n.absZoom?Et(r+_,n.minZoom,n.maxZoom):_,o=_},f=Ea({id:n.id,src:Da.map(m=>he(t,m,n)),xform:q(m=>{const _=m.type;if(_==="$zoom")return o=m.value-r,n.absZoom?r=Et(r+o,n.minZoom,n.maxZoom):r=o,{pos:a.slice(),buttons:0,type:"zoom",active:s,zoom:r,zoomDelta:o,isTouch:!1};const b=Oa(_,!!c);let w=!!m.touches,g=w?Array.from(m.changedTouches):[m];const y=t.getBoundingClientRect();return Aa.has(_)?p(_,g,y,w):Ma.has(_)?h(g):b==="zoom"&&d(m),a=Pn(g[0],y,n.local,n.scale),n.preventDefault&&m.preventDefault(),{event:m,pos:a,buttons:w?s.length:m.buttons,type:b,active:s,zoom:r,zoomDelta:o,isTouch:w}})});return ct(n.zoom)||f.add(n.zoom.map(m=>({type:"$zoom",value:m}))),f},he=(t,e,n,s="")=>{let r=n.eventOpts;return e==="wheel"&&n.preventScrollOnZoom&&(r=_a(r)?{capture:r,passive:!1}:{...r,passive:!1}),we(t,e,r,{id:e+s})},Oa=(t,e)=>t==="mousemove"?e?"drag":"move":Ta[t],Pn=(t,e,n,s)=>{let r=t.clientX,o=t.clientY;if(n&&(r-=e.left,o-=e.top),s){const i=window.devicePixelRatio||1;r*=i,o*=i}return[r|0,o|0]},Pa=()=>typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u",Ca=(t,e)=>(e=Z("interval",{num:1/0,...e}),We(n=>{let s=0,r=e.num;n.next(s++);let o=setInterval(()=>{n.next(s++),--r<=0&&(clearInterval(o),n.closeIn!==$.NEVER&&n.done())},t);return()=>clearInterval(o)},e)),Ra=(t={})=>Pa()?Ca(16,t):We(e=>{let n=0,s=!0;const r=i=>{s&&e.next(t.timestamp?i:n++),s&&(o=requestAnimationFrame(r))};let o=requestAnimationFrame(r);return()=>{s=!1,cancelAnimationFrame(o)}},Z("raf",t)),$a=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/,Na={button:1,option:1,script:1,style:1,text:1,textarea:1,title:1},Xe=t=>t.split(" ").reduce((e,n)=>(e[n]=!0,e),{}),La=Xe("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view");Xe("area base br col command embed hr img input keygen link meta param source stop track use wbr ?xml");Xe("animate circle ellipse line path polygon polyline rect");const Fa=t=>t!=null&&typeof t.deref=="function",Ht=t=>Fa(t)?t.deref():t,Va=t=>{let e="",n;for(let s in t)n=Ht(t[s]),Ys(n)&&(n=n(t)),n!=null&&(e+=`${s}:${n};`);return e},Ha=t=>Object.keys(t).reduce((e,n)=>(e.push(`${n}: ${t[n]}`),e),[]).join(" "),ja="http://www.w3.org/2000/svg",Qt=Y,Ks=Ee,Qs=K,tr=(t,e)=>e.__init&&e.__init.apply(e.__this,[t,...e.__args]),Dt=(t,e,n,s,r,o=!0)=>{if(Qt(s)){const i=s[0];if(typeof i=="function")return Dt(t,e,n,i.apply(null,[t.ctx,...s.slice(1)]),r);const a=s[1];if(a.__impl)return a.__impl.createTree(t,n,s,r,o);const c=e.createElement(n,i,a,r);if(s.length>2){const l=s.length;for(let u=2;u<l;u++)Dt(t,e,c,s[u],void 0,o)}return o&&tr(c,s),c}if(Ks(s)){const i=[];for(let a of s)i.push(Dt(t,e,n,a,r,o));return i}return s==null?n:e.createTextElement(n,s)},Tt=(t,e,n,s,r=0)=>{if(Qt(s)){const o=e.getChild(n,r);typeof s[0]=="function"&&Tt(t,e,n,s[0].apply(null,[t.ctx,...s.slice(1)]),r);const i=s[1];if(i.__impl)return i.__impl.hydrateTree(t,n,s,r);tr(o,s);for(let a in i)a[0]==="o"&&a[1]==="n"&&e.setAttrib(o,a,i[a]);for(let a=s.length,c=2;c<a;c++)Tt(t,e,o,s[c],c-2)}else if(Ks(s))for(let o of s)Tt(t,e,n,o,r),r++},Ua=(t,e,n,s)=>{const r=La[e]?document.createElementNS(ja,e):document.createElement(e);return n&&qa(r,n),er(t,r,s)},Ba=(t,e,n)=>er(t,document.createTextNode(e),n),er=(t,e,n)=>t?n===void 0?t.appendChild(e):t.insertBefore(e,t.children[n]):e,za=(t,e)=>t.children[e],xa=(t,e,n,s,r,o=!0)=>(e.removeChild(n,s),e.createTree(t,n,r,s,o)),Ga=(t,e)=>t.textContent=e,qa=(t,e)=>{for(let n in e)nr(t,n,e[n],e);return t},nr=(t,e,n,s)=>{if(F(n,"deref")&&(n=n.deref()),e.startsWith("__"))return;const r=e[0]==="o"&&e[1]==="n";if(!r&&typeof n=="function"&&(n=n(s)),n!==void 0&&n!==!1)switch(e){case"style":Ja(t,n);break;case"value":Wa(t,n);break;case"prefix":t.setAttribute(e,Qs(n)?n:Ha(n));break;case"accesskey":t.accessKey=n;break;case"contenteditable":t.contentEditable=n;break;case"tabindex":t.tabIndex=n;break;case"align":case"autocapitalize":case"checked":case"dir":case"draggable":case"hidden":case"id":case"lang":case"namespaceURI":case"scrollTop":case"scrollLeft":case"title":t[e]=n;break;default:r?Za(t,e.substring(2),n):t.setAttribute(e,n===!0?"":n)}else t.hasAttribute(e)?t.removeAttribute("title"):t[e]&&(t[e]=null);return t},Wa=(t,e)=>{let n;switch(t.type){case"text":case"textarea":case"password":case"search":case"number":case"email":case"url":case"tel":case"date":case"datetime-local":case"time":case"week":case"month":if((n=t.value)!==void 0&&typeof e=="string"){const s=e.length-(n.length-(t.selectionStart||0));t.value=e,t.selectionStart=t.selectionEnd=s;break}default:t.value=e}},Xa=(t,e,n)=>{for(let s=e.length;s-- >0;){const r=e[s];r[0]==="o"&&r[1]==="n"?Ya(t,r.substring(2),n[r]):t.hasAttribute(r)?t.removeAttribute(r):t[r]=null}},Ja=(t,e)=>(t.setAttribute("style",Va(e)),t),Za=(t,e,n)=>Qs(n)?t.setAttribute("on"+e,n):Qt(n)?t.addEventListener(e,...n):t.addEventListener(e,n),Ya=(t,e,n)=>Qt(n)?t.removeEventListener(e,...n):t.removeEventListener(e,n),Ka=(t,e)=>{const n=t.children[e];n!==void 0&&t.removeChild(n)},Cn=(t,e)=>{if(e=Ht(e),e==null)return t;if(K(e))return t+" "+e;const n=new Set(t.split(" "));for(let s in e)Ht(e[s])?n.add(s):n.delete(s);return[...n].join(" ")},Qa=(t,e,n)=>{e&&(t.id=e);let s=Ht(t.class);return n?(n=n.replace(/\./g," "),t.class=s?Cn(n,s):n):s&&(t.class=K(s)?s:Cn("",s)),t},jt=Y,tc=Ee,ec=Zt,nc=(t,e)=>{let n=t[0],s=ec(t[1]),r,o,i;return(typeof n!="string"||!(r=$a.exec(n)))&&Ps(`${n} is not a valid tag name`),o=r[1],n===o&&s&&(!e||t[1].key)?t:(i=Qa(s?{...t[1]}:{},r[2],r[3]),i.__skip&&t.length<3?[o,i]:[o,i,...t.slice(s?2:1)])},sc=(t,e)=>B(e,t,t.ctx,[0],t.keys!==!1,t.span!==!1),B=(t,e,n,s,r,o)=>{if(t!=null){if(jt(t)){if(t.length===0)return;let i,a=t[1],c;if(a&&(c=a.__impl)&&(c=c.normalizeTree))return c(e,t);const l=t[0];if(typeof l=="function")return B(l.apply(null,[n,...t.slice(1)]),e,n,s,r,o);if(typeof l.render=="function"){const u=[n,...t.slice(1)];return i=B(l.render.apply(l,u),e,n,s,r,o),jt(i)&&(i.__this=l,i.__init=l.init,i.__release=l.release,i.__args=u),i}return i=nc(t,r),a=i[1],a.__normalize===!1?i:(r&&a.key===void 0&&(a.key=s.join("-")),i.length>2?rc(i,a,e,n,s,r,o):i)}return typeof t=="function"?B(t(n),e,n,s,r,o):typeof t.toHiccup=="function"?B(t.toHiccup(e.ctx),e,n,s,r,o):typeof t.deref=="function"?B(t.deref(),e,n,s,r,o):o?["span",r?{key:s.join("-")}:{},t.toString()]:t.toString()}},rc=(t,e,n,s,r,o,i)=>{const a=t[0],c=[a,e];i=i&&!Na[a];for(let l=2,u=2,p=0,h=t.length;l<h;l++){let d=t[l];if(d!=null){const f=jt(d);if(f&&jt(d[0])||!f&&tc(d))for(let m of d)m=B(m,n,s,r.concat(p),o,i),m!==void 0&&(c[u++]=m),p++;else d=B(d,n,s,r.concat(p),o,i),d!==void 0&&(c[u++]=d),p++}}return c},oc={createTree(t,e,n,s,r){return Dt(t,this,e,n,s,r)},hydrateTree(t,e,n,s){return Tt(t,this,e,n,s)},diffTree(t,e,n,s,r){Xn(t,this,e,n,s,r)},normalizeTree:sc,getElementById(t){return document.getElementById(t)},getChild:za,createElement:Ua,createTextElement:Ba,replaceChild(t,e,n,s,r){xa(t,this,e,n,s,r)},removeChild:Ka,setContent:Ga,removeAttribs:Xa,setAttrib:nr},ic=(t,e)=>K(t)?e.getElementById(t):t,ac=(t,e)=>{if(t==null||!e||!e.length)return t;const n={...t};for(let s of e){const r=n[s];F(r,"deref")&&(n[s]=r.deref())}return n};function sr(...t){return t.length>2&&us(sr,t,cs)||(([e,n,s])=>{const[r,o,i]=t[0];let a=t.length>1&&t[1]!=null?t[1]:r();return[e,c=>{let l=o(a);return l!==a&&(c=rt(s(c,l))),a=l,n(c)},(c,l)=>(a=i(a,l),G(a)?os(s(c,a.deref())):s(c,a))]})}const cc=(t={},e=oc)=>{const n={root:"app",...t},s=ic(n.root,e);return sr([()=>[],r=>r,(r,o)=>(n.ctx=ac(t.ctx,n.autoDerefKeys),o=e.normalizeTree(n,o),o!=null?(n.hydrate?(e.hydrateTree(n,s,o),n.hydrate=!1):e.diffTree(n,s,r,o,0),o):r)])},lc=(t,e,n)=>{let s,r,o=0,i=0;return{init(a,c,...l){s=a,fe(s,s.width,s.height),r=s.getContext(t,n),i=Date.now(),e.init&&e.init(s,r,c,...l),e.update&&e.update(s,r,c,i,o++,...l)},render(a,...c){return r&&e.update&&e.update(s,r,a,Date.now()-i,o++,...c),["canvas",c[0]]},release(a,...c){e.release&&e.release(s,r,a,...c)}}},Rn=(t,e)=>lc("2d",t,e),$n=1/2**32;class uc{float(e=1){return this.int()*$n*e}probability(e){return this.float()<e}norm(e=1){return(this.int()*$n-.5)*2*e}normMinMax(e,n){const s=this.minmax(e,n);return this.float()<.5?s:-s}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){return e|=0,e+this.int()%((n|0)-e)}minmaxUint(e,n){return e>>>=0,e+this.int()%((n>>>0)-e)}}class Ut extends AudioWorkletNode{baseURL;json;json_object;parse_ui;parse_group;parse_items;parse_item;output_handler;inputs_items;outputs_items;descriptor;fPitchwheelLabel;fCtrlLabel=[];gui;presets;constructor(e,n,s){super(e,"processor",s),this.baseURL=n,this.json=s.processorOptions.json,this.json_object=JSON.parse(this.json),this.parse_ui=function(o,i){for(var a=0;a<o.length;a++)this.parse_group(o[a],i)},this.parse_group=function(o,i){o.items&&this.parse_items(o.items,i)},this.parse_items=function(o,i){for(var a=0;a<o.length;a++)this.parse_item(o[a],i)},this.parse_item=function(o,i){if(o.type==="vgroup"||o.type==="hgroup"||o.type==="tgroup")this.parse_items(o.items,i);else if(o.type==="hbargraph"||o.type==="vbargraph")i.outputs_items.push(o.address);else if(o.type==="vslider"||o.type==="hslider"||o.type==="button"||o.type==="checkbox"||o.type==="nentry"){if(i.inputs_items.push(o.address),i.descriptor.push(o),o.meta!==void 0)for(var a=0;a<o.meta.length;a++)o.meta[a].midi!==void 0&&(o.meta[a].midi.trim()==="pitchwheel"?i.fPitchwheelLabel.push({path:o.address,min:parseFloat(o.min),max:parseFloat(o.max)}):o.meta[a].midi.trim().split(" ")[0]==="ctrl"&&i.fCtrlLabel[parseInt(o.meta[a].midi.trim().split(" ")[1])].push({path:o.address,min:parseFloat(o.min),max:parseFloat(o.max)}));var c="set"+o.address,l="get"+o.address;c=c.replace(/\/./g,u=>u.substr(1,1).toUpperCase()),l=l.replace(/\/./g,u=>u.substr(1,1).toUpperCase()),i[c]=u=>{i.setParamValue(o.address,u)},i[l]=()=>i.getParamValue(o.address)}},this.output_handler=null,this.inputs_items=[],this.outputs_items=[],this.descriptor=[],this.fPitchwheelLabel=[],this.fCtrlLabel=new Array(128);for(var r=0;r<this.fCtrlLabel.length;r++)this.fCtrlLabel[r]=null;this.parse_ui(this.json_object.ui,this),this.port.onmessage=this.handleMessage.bind(this);try{this.parameters&&this.parameters.forEach(o=>o.automationRate="k-rate")}catch{}}handleMessage(e){var n=e.data;this.output_handler&&this.output_handler(n.path,n.value)}destroy(){this.port.postMessage({type:"destroy"}),this.port.close()}getJSON(){return this.json}getOutputItems(){return this.outputs_items}setParamValue(e,n){this.parameters.get(e)?.setValueAtTime(n,0)}setParam(e,n){this.parameters.get(e)?.setValueAtTime(n,0)}getParamValue(e){return this.parameters.get(e)?.value}getParam(e){return this.parameters.get(e)?.value}setOutputParamHandler(e){this.output_handler=e}getOutputParamHandler(){return this.output_handler}getNumInputs(){return parseInt(this.json_object.inputs)}getNumOutputs(){return parseInt(this.json_object.outputs)}inputChannelCount(){return parseInt(this.json_object.inputs)}outputChannelCount(){return parseInt(this.json_object.outputs)}getParams(){return this.inputs_items}getDescriptor(){var e={};for(const n in this.descriptor)this.descriptor.hasOwnProperty(n)&&this.descriptor[n].label!="bypass"&&(e=Object.assign({[this.descriptor[n].label]:{minValue:this.descriptor[n].min,maxValue:this.descriptor[n].max,defaultValue:this.descriptor[n].init}},e));return e}ctrlChange(e,n,s){const r=this.fCtrlLabel[n];if(r!==null&&Array.isArray(r))for(let o=0;o<r.length;o++){const i=r[o].path;this.setParamValue(i,Ut.remap(s,0,127,r[o].min,r[o].max)),this.output_handler&&this.output_handler(i,this.getParamValue(i))}}pitchWheel(e,n){for(var s=0;s<this.fPitchwheelLabel.length;s++){var r=this.fPitchwheelLabel[s];this.setParamValue(r.path,Ut.remap(n,0,16383,r.min,r.max)),this.output_handler&&this.output_handler(r.path,this.getParamValue(r.path))}}midiMessage(e){var n=e[0]>>4,s=e[0]&15,r=e[1],o=e[2];s!==9&&(n===11?this.ctrlChange(s,r,o):n===14&&this.pitchWheel(s,o*128+r))}onMidi(e){this.midiMessage(e)}async getState(){var e=new Object;for(let n=0;n<this.getParams().length;n++)Object.assign(e,{[this.getParams()[n]]:`${this.getParam(this.getParams()[n])}`});return new Promise(n=>{n(e)})}async setState(e){return new Promise(n=>{for(const s in e)e.hasOwnProperty(s)&&this.setParam(s,e[s]);try{this.gui.setAttribute("state",JSON.stringify(e))}catch(s){console.warn("Plugin without gui or GUI not defined",s)}n(e)})}setPatch(e){this.setState(this.presets[e])}static remap(e,n,s,r,o){return 1*(e-n)/(s-n)*(o-r)+r}}let hc=`

    'use strict';

    // Monophonic Faust DSP
    class Processor extends AudioWorkletProcessor {
        
        // JSON parsing functions
        static parse_ui(ui, obj, callback)
        {
            for (var i = 0; i < ui.length; i++) {
                Processor.parse_group(ui[i], obj, callback);
            }
        }
        
        static parse_group(group, obj, callback)
        {
            if (group.items) {
                Processor.parse_items(group.items, obj, callback);
            }
        }
        
        static parse_items(items, obj, callback)
        {
            for (var i = 0; i < items.length; i++) {
                callback(items[i], obj, callback);
            }
        }
        
        static parse_item1(item, obj, callback)
        {
            if (item.type === "vgroup"
                || item.type === "hgroup"
                || item.type === "tgroup") {
                Processor.parse_items(item.items, obj, callback);
            } else if (item.type === "hbargraph"
                       || item.type === "vbargraph") {
                // Nothing
            } else if (item.type === "vslider"
                       || item.type === "hslider"
                       || item.type === "button"
                       || item.type === "checkbox"
                       || item.type === "nentry") {
                obj.push({ name: item.address,
                         defaultValue: item.init,
                         minValue: item.min,
                         maxValue: item.max });
            }
        }
        
        static parse_item2(item, obj, callback)
        {
            if (item.type === "vgroup"
                || item.type === "hgroup"
                || item.type === "tgroup") {
                Processor.parse_items(item.items, obj, callback);
            } else if (item.type === "hbargraph"
                       || item.type === "vbargraph") {
                // Keep bargraph adresses
                obj.outputs_items.push(item.address);
                obj.pathTable[item.address] = parseInt(item.index);
            } else if (item.type === "vslider"
                       || item.type === "hslider"
                       || item.type === "button"
                       || item.type === "checkbox"
                       || item.type === "nentry") {
                // Keep inputs adresses
                obj.inputs_items.push(item.address);
                obj.pathTable[item.address] = parseInt(item.index);
            }
        }
     
        static get parameterDescriptors() 
        {
            // Analyse JSON to generate AudioParam parameters
            var params = [];
            Processor.parse_ui(JSON.parse(\`JSON_STR\`).ui, params, Processor.parse_item1);
            return params;
        }
       
        constructor(options)
        {

            super(options);

            this.running = true;
            
            const importObject = {
                    env: {
                        memoryBase: 0,
                        tableBase: 0,

                        // Integer version
                        _abs: Math.abs,

                        // Float version
                        _acosf: Math.acos,
                        _asinf: Math.asin,
                        _atanf: Math.atan,
                        _atan2f: Math.atan2,
                        _ceilf: Math.ceil,
                        _cosf: Math.cos,
                        _expf: Math.exp,
                        _floorf: Math.floor,
                        _fmodf: function(x, y) { return x % y; },
                        _logf: Math.log,
                        _log10f: Math.log10,
                        _max_f: Math.max,
                        _min_f: Math.min,
                        _remainderf: function(x, y) { return x - Math.round(x/y) * y; },
                        _powf: Math.pow,
                        _roundf: Math.fround,
                        _sinf: Math.sin,
                        _sqrtf: Math.sqrt,
                        _tanf: Math.tan,
                        _acoshf: Math.acosh,
                        _asinhf: Math.asinh,
                        _atanhf: Math.atanh,
                        _coshf: Math.cosh,
                        _sinhf: Math.sinh,
                        _tanhf: Math.tanh,

                        // Double version
                        _acos: Math.acos,
                        _asin: Math.asin,
                        _atan: Math.atan,
                        _atan2: Math.atan2,
                        _ceil: Math.ceil,
                        _cos: Math.cos,
                        _exp: Math.exp,
                        _floor: Math.floor,
                        _fmod: function(x, y) { return x % y; },
                        _log: Math.log,
                        _log10: Math.log10,
                        _max_: Math.max,
                        _min_: Math.min,
                        _remainder:function(x, y) { return x - Math.round(x/y) * y; },
                        _pow: Math.pow,
                        _round: Math.fround,
                        _sin: Math.sin,
                        _sqrt: Math.sqrt,
                        _tan: Math.tan,
                        _acosh: Math.acosh,
                        _asinh: Math.asinh,
                        _atanh: Math.atanh,
                        _cosh: Math.cosh,
                        _sinh: Math.sinh,
                        _tanh: Math.tanh,

                        table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })
                    }
            };
            
            const wasmModule = new WebAssembly.Module(options.processorOptions.wasm_buffer);
            this.processor_instance = new WebAssembly.Instance(wasmModule, importObject);
            this.json_object = JSON.parse(options.processorOptions.json);
         
            this.output_handler = function(path, value) { this.port.postMessage({ path: path, value: value }); };
            
            this.ins = null;
            this.outs = null;

            this.dspInChannnels = [];
            this.dspOutChannnels = [];

            this.numIn = parseInt(this.json_object.inputs);
            this.numOut = parseInt(this.json_object.outputs);

            // Memory allocator
            this.ptr_size = 4;
            this.sample_size = 4;
            this.integer_size = 4;
            
            this.factory = this.processor_instance.exports;
            this.HEAP = this.processor_instance.exports.memory.buffer;
            this.HEAP32 = new Int32Array(this.HEAP);
            this.HEAPF32 = new Float32Array(this.HEAP);

            // Warning: keeps a ref on HEAP in Chrome and prevent proper GC
            //console.log(this.HEAP);
            //console.log(this.HEAP32);
            //console.log(this.HEAPF32);

            // bargraph
            this.outputs_timer = 5;
            this.outputs_items = [];

            // input items
            this.inputs_items = [];
        
            // Start of HEAP index

            // DSP is placed first with index 0. Audio buffer start at the end of DSP.
            this.audio_heap_ptr = parseInt(this.json_object.size);

            // Setup pointers offset
            this.audio_heap_ptr_inputs = this.audio_heap_ptr;
            this.audio_heap_ptr_outputs = this.audio_heap_ptr_inputs + (this.numIn * this.ptr_size);

            // Setup buffer offset
            this.audio_heap_inputs = this.audio_heap_ptr_outputs + (this.numOut * this.ptr_size);
            this.audio_heap_outputs = this.audio_heap_inputs + (this.numIn * NUM_FRAMES * this.sample_size);
            
            // Start of DSP memory : DSP is placed first with index 0
            this.dsp = 0;

            this.pathTable = [];
         
            // Send output values to the AudioNode
            this.update_outputs = function ()
            {
                if (this.outputs_items.length > 0 && this.output_handler && this.outputs_timer-- === 0) {
                    this.outputs_timer = 5;
                    for (var i = 0; i < this.outputs_items.length; i++) {
                        this.output_handler(this.outputs_items[i], this.HEAPF32[this.pathTable[this.outputs_items[i]] >> 2]);
                    }
                }
            }
            
            this.initAux = function ()
            {
                var i;
                
                if (this.numIn > 0) {
                    this.ins = this.audio_heap_ptr_inputs;
                    for (i = 0; i < this.numIn; i++) {
                        this.HEAP32[(this.ins >> 2) + i] = this.audio_heap_inputs + ((NUM_FRAMES * this.sample_size) * i);
                    }
                    
                    // Prepare Ins buffer tables
                    var dspInChans = this.HEAP32.subarray(this.ins >> 2, (this.ins + this.numIn * this.ptr_size) >> 2);
                    for (i = 0; i < this.numIn; i++) {
                        this.dspInChannnels[i] = this.HEAPF32.subarray(dspInChans[i] >> 2, (dspInChans[i] + NUM_FRAMES * this.sample_size) >> 2);
                    }
                }
                
                if (this.numOut > 0) {
                    this.outs = this.audio_heap_ptr_outputs;
                    for (i = 0; i < this.numOut; i++) {
                        this.HEAP32[(this.outs >> 2) + i] = this.audio_heap_outputs + ((NUM_FRAMES * this.sample_size) * i);
                    }
                    
                    // Prepare Out buffer tables
                    var dspOutChans = this.HEAP32.subarray(this.outs >> 2, (this.outs + this.numOut * this.ptr_size) >> 2);
                    for (i = 0; i < this.numOut; i++) {
                        this.dspOutChannnels[i] = this.HEAPF32.subarray(dspOutChans[i] >> 2, (dspOutChans[i] + NUM_FRAMES * this.sample_size) >> 2);
                    }
                }
                
                // Parse UI
                Processor.parse_ui(this.json_object.ui, this, Processor.parse_item2);
                
                // Init DSP
                this.factory.init(this.dsp, sampleRate); // 'sampleRate' is defined in AudioWorkletGlobalScope  
            }

            this.setParamValue = function (path, val)
            {
                this.HEAPF32[this.pathTable[path] >> 2] = val;
            }

            this.getParamValue = function (path)
            {
                return this.HEAPF32[this.pathTable[path] >> 2];
            }

            // Init resulting DSP
            this.initAux();

        }
        
        process(inputs, outputs, parameters) 
        {
            var input = inputs[0];
            var output = outputs[0];
            
            // Check inputs
            if (this.numIn > 0 && (!input || !input[0] || input[0].length === 0)) {
                console.error("Process input error");
                return true;
            }
            // Check outputs
            if (this.numOut > 0 && (!output || !output[0] || output[0].length === 0)) {
                console.error("Process output error");
                return true;
            }
            
            // Copy inputs
            if (input !== undefined) {
                for (var chan = 0; chan < Math.min(this.numIn, input.length); ++chan) {
                    var dspInput = this.dspInChannnels[chan];
                    dspInput.set(input[chan]);
                }
            }
            
            /*
            TODO: sample accurate control change is not yet handled
            When no automation occurs, params[i][1] has a length of 1,
            otherwise params[i][1] has a length of NUM_FRAMES with possible control change each sample
            */
            
            // Update controls
            for (const path in parameters) {
                const paramArray = parameters[path];
                this.setParamValue(path, paramArray[0]);
            }
        
          	// Compute
            try {
                this.factory.compute(this.dsp, NUM_FRAMES, this.ins, this.outs);
            } catch(e) {
                console.log("ERROR in compute (" + e + ")");
            }
            
            // Update bargraph
            this.update_outputs();
            
            // Copy outputs
            if (output !== undefined) {
                for (var chan = 0; chan < Math.min(this.numOut, output.length); ++chan) {
                    var dspOutput = this.dspOutChannnels[chan];
                    output[chan].set(dspOutput);
                }
            }
            
            return this.running;
    	}
        
        handleMessage(event)
        {
            var msg = event.data;
            switch (msg.type) {
                case "destroy": this.running = false; break;
            }
        }
    }

    // Globals
    const NUM_FRAMES = 128;
    try {
        registerProcessor('processor', Processor);
    } catch (error) {
        console.error("Can't register processor,", error);
    }
`;function fc(t){let e="",n=0;for(;t[n]!==0;)e+=String.fromCharCode(t[n++]);return e}async function dc(t,e){let n=[];try{const s={env:{memoryBase:0,tableBase:0,_abs:Math.abs,_acosf:Math.acos,_asinf:Math.asin,_atanf:Math.atan,_atan2f:Math.atan2,_ceilf:Math.ceil,_cosf:Math.cos,_expf:Math.exp,_floorf:Math.floor,_fmodf:(d,f)=>d%f,_logf:Math.log,_log10f:Math.log10,_max_f:Math.max,_min_f:Math.min,_remainderf:(d,f)=>d-Math.round(d/f)*f,_powf:Math.pow,_roundf:Math.fround,_sinf:Math.sin,_sqrtf:Math.sqrt,_tanf:Math.tan,_acoshf:Math.acosh,_asinhf:Math.asinh,_atanhf:Math.atanh,_coshf:Math.cosh,_sinhf:Math.sinh,_tanhf:Math.tanh,_isnanf:Number.isNaN,_isinff:function(d){return!isFinite(d)},_copysignf:function(d,f){return Math.sign(d)===Math.sign(f)?d:-d},_acos:Math.acos,_asin:Math.asin,_atan:Math.atan,_atan2:Math.atan2,_ceil:Math.ceil,_cos:Math.cos,_exp:Math.exp,_floor:Math.floor,_fmod:(d,f)=>d%f,_log:Math.log,_log10:Math.log10,_max_:Math.max,_min_:Math.min,_remainder:(d,f)=>d-Math.round(d/f)*f,_pow:Math.pow,_round:Math.fround,_sin:Math.sin,_sqrt:Math.sqrt,_tan:Math.tan,_acosh:Math.acosh,_asinh:Math.asinh,_atanh:Math.atanh,_cosh:Math.cosh,_sinh:Math.sinh,_tanh:Math.tanh,_isnan:Number.isNaN,_isinf:function(d){return!isFinite(d)},_copysign:function(d,f){return Math.sign(d)===Math.sign(f)?d:-d},table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},o=await(await fetch(e)).arrayBuffer(),i=await WebAssembly.compile(o),a=await WebAssembly.instantiate(i,s);let c=new Uint8Array(a.exports.memory.buffer),l=fc(c),u=JSON.parse(l),p={json:l,wasm_buffer:o};if(n.indexOf(e)===-1)try{let d=/JSON_STR/g,f=hc.replace(d,l),m=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"}));await t.audioWorklet.addModule(m),console.log("Keep the DSP url"),n.push(e)}catch(d){return console.error("Faust "+e+" cannot be loaded or compiled,",d),null}let h=new Ut(t,e,{numberOfInputs:parseInt(u.inputs)>0?1:0,numberOfOutputs:parseInt(u.outputs)>0?1:0,channelCount:Math.max(1,parseInt(u.inputs)),outputChannelCount:[parseInt(u.outputs)],channelCountMode:"explicit",channelInterpretation:"speakers",processorOptions:p});return h.onprocessorerror=d=>{console.error("An error from processor was detected,",d)},h}catch(s){return console.error("Faust "+e+" cannot be loaded or compiled,",s),null}}const Nn=(t,e,n,s,r,o,i)=>{const{x:a,y:c,w:l,h:u}=mt(e);return pc(t,n,a,c,r?u:l,u,r?u:0,s,o,i)},pc=(t,e,n,s,r,o,i,a,c,l)=>{const u=t.theme,p=tt([n,s,r,o]);t.registerID(e,p);let h;const d=t.resource(e,p,()=>ot([n,s],[r,o])),f=Bs(t,e,d,l),m=t.requestFocus(e);let _=!t.buttons&&t.hotID===e&&t.activeID===e;return m&&(_=zs(t)||_),_&&(h=a=!a),t.draw&&(d.attribs={fill:a?t.fgColor(f):t.bgColor(f),stroke:t.focusColor(e)},t.add(d),c&&t.add(_t([n+u.pad+i,s+o/2+u.baseLine],t.textColor(f&&i>0&&i<r-u.pad),c))),t.lastID=e,h},mc=3737844653;class Je extends uc{constructor(e=mc){super(),this.buffer=new Uint32Array([e,0])}copy(){const e=new Je;return e.buffer.set(this.buffer),e}seed(e){return this.buffer.set([e,0]),this}int(){const e=this.buffer,n=1540483477,s=e[1]++*n>>>0,r=e[0]=(s^s>>24^e[0]*n>>>0)*n>>>0;return(r^r>>>13)>>>0}}const Ln=new Je(3737844653),_c=t=>{if(t.state!=="suspended")return;const e=document.body,n=["touchstart","touchend","mousedown","keydown"],s=()=>t.resume().then(r),r=()=>n.forEach(o=>e.removeEventListener(o,s));n.forEach(o=>e.addEventListener(o,s,!1))},te=new AudioContext;_c(te);const D=await dc(te,"./melody.wasm"),ut=te.createAnalyser(),It=new Uint8Array(ut.fftSize),Se=ut.frequencyBinCount,Fn=new Float32Array(Se);D&&(D.setOutputParamHandler((t,e)=>{console.log(t,e)}),D.connect(te.destination),D.connect(ut));const Vn=[Os,{globalBg:"#ccc",focus:[1,.66,0,1],cursor:[0,0,0,1],bg:[1,1,1,.66],bgDisabled:[1,1,1,.33],bgHover:[1,1,1,.9],fg:[.8,0,.8,1],fgDisabled:[.8,0,.8,.5],fgHover:[1,0,1,1],text:[.3,.3,.3,1],textDisabled:[.3,.3,.3,.5],textHover:[.2,.2,.4,1],bgTooltip:[1,1,.8,.85],textTooltip:[0,0,0,1]}],bc=Me(0),gc=Me(2),yc=`${320*30/600}px 'IBM Plex Mono'`,wc=["KICK","HATS","CHRD","MRMB","DJMB"],Sc=["kick/volume","hat/volume","chords/volume","marimba/volume","djembe/volume"],Ic=["i-iv-VI-v","i-iv-III-VI","i-VI-III-VII","i-VI-III-iv","I-vi-IV-V","I-V-vi-IV","I-IV-V-IV","vi-IV-I-V","I-IV-ii-V","I-IV-I-V"],Ec=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],P=new de({theme:0,channels:[.5,.5,.5,.5,.5],bpm:118,progression:0,key:0,kickSteps:new Array(16).fill(!1),hatSteps:new Array(16).fill(!1)}),Hn=t=>({...Vn[t%Vn.length],font:yc,cursorBlink:0}),vc=()=>{const t=new ma({theme:Hn(P.deref().theme)}),e={...si,init(a){ka(a,{}).subscribe({next(c){t.setMouse(c.pos,c.buttons)}}),we(window,"keydown").subscribe({next(c){c.key===S.TAB&&c.preventDefault(),t.setKey(c)}}),we(window,"keyup").subscribe({next(c){t.setKey(c)}})}},n=Rn({update(a,c,l,u,p,h){const d=h.width,f=h.height;fe(a,d,f),ut.getByteTimeDomainData(It);const m=a.width/It.length*(en()?2:1);c.clearRect(0,0,a.width,a.width),c.beginPath();for(let _=0;_<It.length;_+=4){const b=It[_]/256*(en()?2:1),w=0+_*m,g=0+f*b;c.lineTo(w,g)}c.stroke()}}),s=Rn({update(a,c,l,u,p,h){const _=c.getImageData(0,0,a.width,a.height);fe(a,h.width,h.height),c.putImageData(_,0,0),ut.getFloatFrequencyData(Fn);const b=a.height/Se;for(let w=0;w<Se;w++){const g=Math.pow(1.8,Fn[w]/25),y=120+w/3;c.fillStyle=`hsl(${360*-g+y}deg, 100%, ${g*100}%)`,c.fillRect(a.width-1,-w*b+a.height,1,b)}c.save(),c.translate(-1,0),c.drawImage(a,0,0),c.restore()}}),r=a=>`/melody/${a}`,o=P.deref();o.kickSteps.forEach((a,c)=>{const l=Ln.float()>.5;D?.setParamValue(r(`kickStep${c}`),l?1:0),P.resetIn(["kickSteps",c],l)}),o.hatSteps.forEach((a,c)=>{const l=Ln.float()>.5;D?.setParamValue(r(`hatStep${c}`),l?1:0),P.resetIn(["hatSteps",c],l)});const i=(a,c)=>{const u=P.deref(),p=c/40,h=Ws(10,10,a-20,1,p,4),d=c/40;t.setTheme({...Hn(u.theme),font:`${d}px 'IBM Plex Mono'`}),t.begin(!0);let f;const m=h.nest(1,[1,5]);le(t,m,"PROGRESSION"),(f=An(t,m,"progression",u.progression,Ic,""))!==void 0&&(D?.setParamValue(r("progression"),f),D?.setParamValue(r("scale"),f>3?1:0),P.resetIn(["progression"],f)),le(t,m,"KEY"),(f=An(t,m,"key",u.key,Ec,""))!==void 0&&(D?.setParamValue(r("key"),f),P.resetIn(["key"],f));const _=h.nest(5,[1,8]);Sc.forEach((y,I)=>{const v=_.nest(1);(f=da(t,v,y,0,1,.01,u.channels[I],8,"",gc))!==void 0&&(D?.setParamValue(r(y),f),P.resetIn(["channels",I],f)),le(t,v,wc[I])});const b=h.nest(5,[2,3]);(f=ha(t,b,"bpm",30,180,1,u.bpm,zt,.5,"BPM",bc))!==void 0&&(D?.setParamValue(r("bpm"),f),P.resetIn(["bpm"],f)),Ki(t,b,"resync",3,"SYNC")&&(D?.setParamValue(r("reset"),1),D?.setParamValue(r("reset"),0));const w=h.nest(16);u.kickSteps.forEach((y,I)=>{(f=Nn(t,w,`kickStep${I}`,u.kickSteps[I],!1,""))!==void 0&&(D?.setParamValue(r(`kickStep${I}`),f?1:0),P.resetIn(["kickSteps",I],f))});const g=h.nest(16);u.hatSteps.forEach((y,I)=>{(f=Nn(t,g,`hatStep${I}`,u.hatSteps[I],!1,""))!==void 0&&(D?.setParamValue(r(`hatStep${I}`),f?1:0),P.resetIn(["hatSteps",I],f))}),t.end()};return()=>{const a=window.innerWidth,c=window.innerHeight;return i(a,c/3*2),["div",[n,{width:a,height:c/3/2}],["br"],[s,{width:a,height:c/3/2}],,[e,{width:a,height:c/3*2,style:{background:t.theme.globalBg,cursor:t.cursor},oncontextmenu:l=>l.preventDefault(),...t.attribs},t]]}};Ra().transform(q(vc()),cc());
